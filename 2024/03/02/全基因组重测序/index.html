<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="全基因组重测序, HL&#39;s blog">
    <meta name="description" content="#!/usr/local/bin/python3  
-- coding: utf-8 --This script file shoud be at the same directory with Cleandata2022.02.09de">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>全基因组重测序 | HL&#39;s blog</title>
    <link rel="icon" type="image/png" href="/favicon.png">
    


    <!-- bg-cover style     -->



<link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
<link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
<link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
<link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
<link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
<link rel="stylesheet" type="text/css" href="/css/matery.css">
<link rel="stylesheet" type="text/css" href="/css/my.css">
<link rel="stylesheet" type="text/css" href="/css/dark.css" media="none" onload="if(media!='all')media='all'">




    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
    <link rel="stylesheet" href="/css/post.css">




    
        <link rel="stylesheet" type="text/css" href="/css/reward.css">
    



    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 5.4.2"></head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">HL&#39;s blog</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="" class="waves-effect waves-light">

      
      <i class="fas fa-tools" style="zoom: 0.6;"></i>
      
      <span>有趣工具</span>
      <i class="fas fa-chevron-down" aria-hidden="true" style="zoom: 0.6;"></i>
    </a>
    <ul class="sub-nav menus_item_child ">
      
      <li>
        <a href="/html/%E9%9A%8F%E6%9C%BA%E8%BD%AE%E7%9B%98.html">
          
          <i class="fas fa-random" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>随机轮盘</span>
        </a>
      </li>
      
      <li>
        <a href="/html/%E4%B8%8D%E8%A6%81%E7%86%AC%E5%A4%9C.html">
          
          <i class="fas fa-moon" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>不要熬夜</span>
        </a>
      </li>
      
      <li>
        <a href="/html/%E4%BF%9D%E6%8A%A4%E7%9C%BC%E7%9D%9B.html">
          
          <i class="fas fa-eye" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>保护眼睛</span>
        </a>
      </li>
      
      <li>
        <a href="/html/%E5%A4%AA%E9%98%B3.html">
          
          <i class="fas fa-sun" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>太阳</span>
        </a>
      </li>
      
      <li>
        <a href="/html/%E6%96%87%E5%AD%97%E8%BD%AC%E8%AF%AD%E8%A8%80.html">
          
          <i class="fas fa-volume-up" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>文字转语言</span>
        </a>
      </li>
      
      <li>
        <a href="/html/tnt%E5%BC%B9%E9%81%93%E8%BE%85%E5%8A%A9.html">
          
          <i class="fas fa-crosshairs" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>tnt弹道辅助</span>
        </a>
      </li>
      
      <li>
        <a href="/html/%E5%AE%8C%E4%B8%8D%E6%88%90%E7%9A%84%E6%AF%8F%E6%97%A5%E4%BB%BB%E5%8A%A1.html">
          
          <i class="fas fa-tasks" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>完不成的每日任务</span>
        </a>
      </li>
      
      <li>
        <a href="/html/%E5%AD%A6%E4%B9%A0.html">
          
          <i class="fas fa-book" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>学习</span>
        </a>
      </li>
      
      <li>
        <a href="/html/%E8%87%AA%E5%BE%8B%E6%9C%AC.html">
          
          <i class="fas fa-check-square" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>自律本</span>
        </a>
      </li>
      
      <li>
        <a href="/html/%E8%87%AA%E5%BE%8B%E8%AF%BE%E8%A1%A8.html">
          
          <i class="fas fa-calendar-alt" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>自律课表</span>
        </a>
      </li>
      
      <li>
        <a href="/html/%E9%9F%B3%E4%B9%90.html">
          
          <i class="fas fa-music" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>音乐</span>
        </a>
      </li>
      
      <li>
        <a href="/html/word.html">
          
          <i class="fas fa-file-word" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>Word文件</span>
        </a>
      </li>
      
      <li>
        <a href="/html/%E4%BB%BB%E5%8A%A1%E5%88%86%E5%8C%96.html">
          
          <i class="fas fa-file-word" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>任务分化</span>
        </a>
      </li>
      
    </ul>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="" class="waves-effect waves-light">

      
      <i class="fas fa-book-open" style="zoom: 0.6;"></i>
      
      <span>日记</span>
      <i class="fas fa-chevron-down" aria-hidden="true" style="zoom: 0.6;"></i>
    </a>
    <ul class="sub-nav menus_item_child ">
      
      <li>
        <a href="/diaries/travel">
          
          <i class="fas fa-plane" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>我的旅行日记</span>
        </a>
      </li>
      
      <li>
        <a href="/diaries/daily">
          
          <i class="fas fa-home" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>日常生活</span>
        </a>
      </li>
      
    </ul>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="" class="waves-effect waves-light">

      
      <i class="fas fa-file-word" style="zoom: 0.6;"></i>
      
      <span>word教程</span>
      <i class="fas fa-chevron-down" aria-hidden="true" style="zoom: 0.6;"></i>
    </a>
    <ul class="sub-nav menus_item_child ">
      
      <li>
        <a href="/word-tutorials/basics">
          
          <i class="fas fa-graduation-cap" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>基础教程</span>
        </a>
      </li>
      
      <li>
        <a href="/word-tutorials/advanced">
          
          <i class="fas fa-user-graduate" style="margin-top: -20px; zoom: 0.6;"></i>
          
          <span>高级技巧</span>
        </a>
      </li>
      
    </ul>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
  <li>
    <a href="javascript:;" class="waves-effect waves-light" onclick="switchNightMode()" title="深色/浅色模式" >
      <i id="sum-moon-icon" class="fas fa-sun" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">HL&#39;s blog</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="javascript:;">
			
				<i class="fa-fw fas fa-tools"></i>
			
			有趣工具
			<span class="m-icon"><i class="fas fa-chevron-right"></i></span>
		</a>
            <ul  style="background:  ;" >
              
                <li>

                  <a href="/html/%E9%9A%8F%E6%9C%BA%E8%BD%AE%E7%9B%98.html " style="margin-left:75px">
				  
				   <i class="fa fas fa-random" style="position: absolute;left:50px" ></i>
			      
		          <span>随机轮盘</span>
                  </a>
                </li>
              
                <li>

                  <a href="/html/%E4%B8%8D%E8%A6%81%E7%86%AC%E5%A4%9C.html " style="margin-left:75px">
				  
				   <i class="fa fas fa-moon" style="position: absolute;left:50px" ></i>
			      
		          <span>不要熬夜</span>
                  </a>
                </li>
              
                <li>

                  <a href="/html/%E4%BF%9D%E6%8A%A4%E7%9C%BC%E7%9D%9B.html " style="margin-left:75px">
				  
				   <i class="fa fas fa-eye" style="position: absolute;left:50px" ></i>
			      
		          <span>保护眼睛</span>
                  </a>
                </li>
              
                <li>

                  <a href="/html/%E5%A4%AA%E9%98%B3.html " style="margin-left:75px">
				  
				   <i class="fa fas fa-sun" style="position: absolute;left:50px" ></i>
			      
		          <span>太阳</span>
                  </a>
                </li>
              
                <li>

                  <a href="/html/%E6%96%87%E5%AD%97%E8%BD%AC%E8%AF%AD%E8%A8%80.html " style="margin-left:75px">
				  
				   <i class="fa fas fa-volume-up" style="position: absolute;left:50px" ></i>
			      
		          <span>文字转语言</span>
                  </a>
                </li>
              
                <li>

                  <a href="/html/tnt%E5%BC%B9%E9%81%93%E8%BE%85%E5%8A%A9.html " style="margin-left:75px">
				  
				   <i class="fa fas fa-crosshairs" style="position: absolute;left:50px" ></i>
			      
		          <span>tnt弹道辅助</span>
                  </a>
                </li>
              
                <li>

                  <a href="/html/%E5%AE%8C%E4%B8%8D%E6%88%90%E7%9A%84%E6%AF%8F%E6%97%A5%E4%BB%BB%E5%8A%A1.html " style="margin-left:75px">
				  
				   <i class="fa fas fa-tasks" style="position: absolute;left:50px" ></i>
			      
		          <span>完不成的每日任务</span>
                  </a>
                </li>
              
                <li>

                  <a href="/html/%E5%AD%A6%E4%B9%A0.html " style="margin-left:75px">
				  
				   <i class="fa fas fa-book" style="position: absolute;left:50px" ></i>
			      
		          <span>学习</span>
                  </a>
                </li>
              
                <li>

                  <a href="/html/%E8%87%AA%E5%BE%8B%E6%9C%AC.html " style="margin-left:75px">
				  
				   <i class="fa fas fa-check-square" style="position: absolute;left:50px" ></i>
			      
		          <span>自律本</span>
                  </a>
                </li>
              
                <li>

                  <a href="/html/%E8%87%AA%E5%BE%8B%E8%AF%BE%E8%A1%A8.html " style="margin-left:75px">
				  
				   <i class="fa fas fa-calendar-alt" style="position: absolute;left:50px" ></i>
			      
		          <span>自律课表</span>
                  </a>
                </li>
              
                <li>

                  <a href="/html/%E9%9F%B3%E4%B9%90.html " style="margin-left:75px">
				  
				   <i class="fa fas fa-music" style="position: absolute;left:50px" ></i>
			      
		          <span>音乐</span>
                  </a>
                </li>
              
                <li>

                  <a href="/html/word.html " style="margin-left:75px">
				  
				   <i class="fa fas fa-file-word" style="position: absolute;left:50px" ></i>
			      
		          <span>Word文件</span>
                  </a>
                </li>
              
                <li>

                  <a href="/html/%E4%BB%BB%E5%8A%A1%E5%88%86%E5%8C%96.html " style="margin-left:75px">
				  
				   <i class="fa fas fa-file-word" style="position: absolute;left:50px" ></i>
			      
		          <span>任务分化</span>
                  </a>
                </li>
              
            </ul>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="javascript:;">
			
				<i class="fa-fw fas fa-book-open"></i>
			
			日记
			<span class="m-icon"><i class="fas fa-chevron-right"></i></span>
		</a>
            <ul  style="background:  ;" >
              
                <li>

                  <a href="/diaries/travel " style="margin-left:75px">
				  
				   <i class="fa fas fa-plane" style="position: absolute;left:50px" ></i>
			      
		          <span>我的旅行日记</span>
                  </a>
                </li>
              
                <li>

                  <a href="/diaries/daily " style="margin-left:75px">
				  
				   <i class="fa fas fa-home" style="position: absolute;left:50px" ></i>
			      
		          <span>日常生活</span>
                  </a>
                </li>
              
            </ul>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="javascript:;">
			
				<i class="fa-fw fas fa-file-word"></i>
			
			word教程
			<span class="m-icon"><i class="fas fa-chevron-right"></i></span>
		</a>
            <ul  style="background:  ;" >
              
                <li>

                  <a href="/word-tutorials/basics " style="margin-left:75px">
				  
				   <i class="fa fas fa-graduation-cap" style="position: absolute;left:50px" ></i>
			      
		          <span>基础教程</span>
                  </a>
                </li>
              
                <li>

                  <a href="/word-tutorials/advanced " style="margin-left:75px">
				  
				   <i class="fa fas fa-user-graduate" style="position: absolute;left:50px" ></i>
			      
		          <span>高级技巧</span>
                  </a>
                </li>
              
            </ul>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    
<script src="/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/11.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">全基因组重测序</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                          <div class="article-tag">
                            <span class="chip bg-color">无标签</span>
                          </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2024-03-02
                </div>
                

                

                

                

                
            </div>
        </div>
        <hr class="clearfix">

        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <p>#!/usr/local/bin/python3  </p>
<h1 id="coding-utf-8"><a href="#coding-utf-8" class="headerlink" title="-- coding: utf-8 --"></a>-<em>- coding: utf-8 -</em>-</h1><h1 id="This-script-file-shoud-be-at-the-same-directory-with-Cleandata"><a href="#This-script-file-shoud-be-at-the-same-directory-with-Cleandata" class="headerlink" title="This script file shoud be at the same directory with Cleandata"></a>This script file shoud be at the same directory with Cleandata</h1><h1 id="2022-02-09"><a href="#2022-02-09" class="headerlink" title="2022.02.09"></a>2022.02.09</h1><h1 id="delete-redundancy-bamFile"><a href="#delete-redundancy-bamFile" class="headerlink" title="delete redundancy  bamFile"></a>delete redundancy  bamFile</h1><h1 id="python3-0-t-9-i-input-dir-r-ReferenceFile"><a href="#python3-0-t-9-i-input-dir-r-ReferenceFile" class="headerlink" title="python3  $0 -t 9 -i input_dir -r ReferenceFile"></a>python3  $0 -t 9 -i input_dir -r ReferenceFile</h1><p>import os, sys, glob, time, argparse,threading</p>
<p>my_parser = argparse.ArgumentParser()</p>
<p>my_parser.add_argument(‘-t’, dest=’thread’,type=int,default=’4’) #线程数</p>
<p>my_parser.add_argument(‘-i’, dest=’input_dir’) #线程数</p>
<p>my_parser.add_argument(‘-r’, dest=’reference’) #线程数</p>
<p>args = my_parser.parse_args()</p>
<p>TimeTable = open(args.input_dir+’TimeTable.txt’,’w’)</p>
<p>ref=args.reference</p>
<p>output_bam_dir = args.input_dir + ‘_bam_dir’</p>
<p>output_gvcf_dir = args.input_dir + ‘_gvcf_dir’</p>
<p>if os.path.exists(output_bam_dir):</p>
<pre><code>sys.exit(output_bam_dir+&#39; exist!!!&#39;)
</code></pre>
<p>elif os.path.exists(output_gvcf_dir):</p>
<pre><code>sys.exit(output_gvcf_dir+&#39; exist!!!&#39;)
</code></pre>
<p>else:</p>
<pre><code>os.makedirs(output_bam_dir)

os.makedirs(output_gvcf_dir)
</code></pre>
<p>def mult(funct, ls, n=3):</p>
<pre><code>pool = []  # 线程池

length = len(ls)

step = int(length / n) + 1

for i in range(0, length, step):

    p = threading.Thread(target=funct, args=(ls[i: i + step],)) #把ls切成了n段，每段step长，最后段可能断一点

    pool.append(p)

for p in pool: #pool包含列表的列表，长度为n（即n个列表），每一个列表长度为step。

    p.start() #这里同时启动n个进程，一个进程里加入参数ls[i: i + step]，funct函数会对ls[i: i + step]慢慢处理。

for p in pool:

    p.join() #等待所有进程结束

print(time.strftime(&#39;%Y-%m-%d %H:%M:%S&#39;,time.localtime(time.time()))+&#39;_Main thread STAR exiting&#39;, file=TimeTable)

TimeTable.flush()
</code></pre>
<p>sample_names_dir = glob.glob(args.input_dir+’/*’) # Every sample has a directory which contain fq.gz file 每个样品单独一个文件夹，文件夹下包含fq.gz的文件 不包含绝对路径</p>
<p>bam_list = []</p>
<p>all_sample_fq = {} # This dictionary will include the sample’s name (key) and fq.gz (value) 字典以样品名为键，以1或2.fq.gz文件名为值</p>
<p>def bwa(part_sample_directory): #把bwa封装</p>
<pre><code>for sample_dir in part_sample_directory:

    sample_head = os.path.basename(sample_dir)

    if not (os.path.exists(sample_dir+&#39;/&#39;+sample_head+&#39;_R1.fq.gz&#39;) and os.path.exists(sample_dir+&#39;/&#39;+sample_head+&#39;_R1.fq.gz&#39;)):

        sys.exit(sample_dir+&#39;/&#39;+sample_head+&#39;_R1.fq.gz&#39; + &#39; or &#39;+sample_dir+&#39;/&#39;+sample_head+&#39;_R1.fq.gz&#39; + &quot; don&#39;t exist!!!&quot;)

    os.system(&#39;bwa mem -M -t 4 -R  &quot;@RG\\tID:&#123;0&#125;\\tSM:&#123;0&#125;\\tPL:illumina\\tLB:lib1\\tPU:unit1&quot; &#123;1&#125; &#123;2&#125;/&#123;0&#125;_R1.fq.gz &#123;2&#125;/&#123;0&#125;_R2.fq.gz | samtools view -bhS -o &#123;3&#125;/&#123;0&#125;.bam&#39;.format(sample_head, ref, sample_dir, output_bam_dir))

    print(time.strftime(&#39;%Y-%m-%d %H:%M:%S&#39;,time.localtime(time.time()))+&#39;bwa programming finished***In threading***&#39;+sample_head, file=TimeTable)

    TimeTable.flush()

    time.sleep(0.2)

    os.system(&#39;java -jar picard.jar SortSam INPUT=&#123;0&#125;/&#123;1&#125;.bam OUTPUT=&#123;0&#125;/&#123;1&#125;_sorted.bam SORT_ORDER=coordinate TMP_DIR=./tmp&#39;.format(output_bam_dir,sample_head))

    time.sleep(0.2)

    os.system(&#39;rm &#123;0&#125;/&#123;1&#125;.bam&#39;.format(output_bam_dir,sample_head))

    os.system(&#39;java -jar picard.jar AddOrReplaceReadGroups I=&#123;0&#125;/&#123;1&#125;_sorted.bam O=&#123;0&#125;/&#123;1&#125;_sorted_add.bam RGLB=lib1 RGPL=illumina RGPU=unit1 RGSM=&#123;1&#125; TMP_DIR=./tmp&#39;.format(output_bam_dir,sample_head))

    time.sleep(0.2)

    os.system(&#39;rm &#123;0&#125;/&#123;1&#125;_sorted.bam&#39;.format(output_bam_dir,sample_head))

    os.system(&#39;java -jar picard.jar MarkDuplicates I=&#123;0&#125;/&#123;1&#125;_sorted_add.bam O=&#123;0&#125;/&#123;1&#125;_sorted_add_dedup.bam M=&#123;0&#125;/&#123;1&#125;_sorted_add_dedup.metrics CREATE_INDEX=true MAX_FILE_HANDLES_FOR_READ_ENDS_MAP=4000 TMP_DIR=./tmp&#39;.format(output_bam_dir,sample_head))

    time.sleep(0.2)

    os.system(&#39;rm &#123;0&#125;/&#123;1&#125;_sorted_add.bam&#39;.format(output_bam_dir,sample_head))

    print(time.strftime(&#39;%Y-%m-%d %H:%M:%S&#39;,time.localtime(time.time()))+&#39;java -jar picard.jar BuildBamIndex programming finished***In threading***&#39;+sample_head, file=TimeTable)

    os.system(&quot;java -jar /home/data1/renminpeng/SRR2131201/gatk-package-4.1.8.1-local.jar HaplotypeCaller -R &#123;0&#125; GVCF -I &#123;1&#125;/&#123;2&#125;_sorted_add_dedup.bam -o &#123;3&#125;/&#123;2&#125;.g.vcf&quot;.format(ref, output_bam_dir,sample_head,output_gvcf_dir))

    print(time.strftime(&#39;%Y-%m-%d %H:%M:%S&#39;,time.localtime(time.time()))+&#39;java -jar /home/data1/renminpeng/SRR2131201/gatk-package-4.1.8.1-local.jar programming finished***In threading***&#39;+sample_head, file=TimeTable)

    TimeTable.flush()

    bam_list.append(&#39;--variant  &#123;0&#125;/&#123;1&#125;.g.vcf&#39;.format(output_gvcf_dir,sample_head))
</code></pre>
<h3 id="在linux中，我有一个文件夹名字为-数字，然后下面有很多文件，SRR213201，SRR213202等等，每个文件里有sra文件，我现在想让他们转换成faatq格式，在自己的文件夹下，有什么命令实现吗？"><a href="#在linux中，我有一个文件夹名字为-数字，然后下面有很多文件，SRR213201，SRR213202等等，每个文件里有sra文件，我现在想让他们转换成faatq格式，在自己的文件夹下，有什么命令实现吗？" class="headerlink" title="在linux中，我有一个文件夹名字为 数字，然后下面有很多文件，SRR213201，SRR213202等等，每个文件里有sra文件，我现在想让他们转换成faatq格式，在自己的文件夹下，有什么命令实现吗？"></a>在linux中，我有一个文件夹名字为 数字，然后下面有很多文件，SRR213201，SRR213202等等，每个文件里有sra文件，我现在想让他们转换成faatq格式，在自己的文件夹下，有什么命令实现吗？</h3><p>转换命令一般用这个 fastq-dump SRR213201 –outdir /home/data1/renminpeng/SRR213201 –split-files SRR213201</p>
<p>要在Linux中将多个 <code>.sra</code> 文件转换为 <code>fastq</code> 格式，并保持每个文件在其自己的目录中，您可以使用一个简单的 <code>bash</code> 脚本来自动化这个过程。给定您的需求和已提供的转换命令模板，以下是一个示例脚本，它会遍历名为 <code>数字</code> 的文件夹中的所有子文件夹，查找 <code>.sra</code> 文件，并使用 <code>fastq-dump</code> 工具进行转换。</p>
<p>首先，确保您有SRA Toolkit安装在您的系统上，因为 <code>fastq-dump</code> 命令是该工具包的一部分。</p>
<p>然后，您可以创建一个脚本，如下所示：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置包含子文件夹的父文件夹路径</span></span><br><span class="line">PARENT_DIR=<span class="string">&quot;/path/to/数字&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 遍历每个子文件夹</span></span><br><span class="line"><span class="keyword">for</span> SUBDIR <span class="keyword">in</span> <span class="variable">$&#123;PARENT_DIR&#125;</span>/*; <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> [ -d <span class="string">&quot;<span class="variable">$&#123;SUBDIR&#125;</span>&quot;</span> ]; <span class="keyword">then</span> <span class="comment"># 确保它是一个目录</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Processing <span class="variable">$&#123;SUBDIR&#125;</span>...&quot;</span></span><br><span class="line">        <span class="comment"># 在每个子文件夹中查找所有.sra文件</span></span><br><span class="line">        <span class="keyword">for</span> SRA_FILE <span class="keyword">in</span> <span class="variable">$&#123;SUBDIR&#125;</span>/*.sra; <span class="keyword">do</span></span><br><span class="line">            <span class="keyword">if</span> [ -f <span class="string">&quot;<span class="variable">$&#123;SRA_FILE&#125;</span>&quot;</span> ]; <span class="keyword">then</span> <span class="comment"># 确保.sra文件存在</span></span><br><span class="line">                <span class="comment"># 获取不带扩展名的文件名</span></span><br><span class="line">                FILE_NAME=$(<span class="built_in">basename</span> <span class="string">&quot;<span class="variable">$&#123;SRA_FILE&#125;</span>&quot;</span> .sra)</span><br><span class="line">                <span class="comment"># 构建输出目录，这里使用与SRA文件相同的目录</span></span><br><span class="line">                OUT_DIR=<span class="string">&quot;<span class="variable">$&#123;SUBDIR&#125;</span>&quot;</span></span><br><span class="line">                <span class="comment"># 调用fastq-dump进行转换</span></span><br><span class="line">                fastq-dump <span class="string">&quot;<span class="variable">$&#123;SRA_FILE&#125;</span>&quot;</span> --outdir <span class="string">&quot;<span class="variable">$&#123;OUT_DIR&#125;</span>&quot;</span> --split-files</span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&quot;Converted <span class="variable">$&#123;SRA_FILE&#125;</span> to fastq format.&quot;</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;All .sra files have been converted to fastq format.&quot;</span></span><br></pre></td></tr></table></figure>

<p>请按照以下步骤使用此脚本：</p>
<ol>
<li>将上述脚本保存到一个文件中，例如 <code>convert_sra_to_fastq.sh</code>。</li>
<li>修改 <code>PARENT_DIR</code> 变量，使其指向包含所有子文件夹的父文件夹的路径（在您的例子中，这个路径是包含所有SRR开头的文件夹的 <code>数字</code> 文件夹的路径）。</li>
<li>赋予脚本执行权限：<code>chmod +x convert_sra_to_fastq.sh</code>。</li>
<li>执行脚本：<code>./convert_sra_to_fastq.sh</code>。</li>
</ol>
<p>这个脚本会遍历每个子文件夹，查找所有 <code>.sra</code> 文件，并使用 <code>fastq-dump</code> 将它们转换为 <code>fastq</code> 格式，转换后的文件将保存在源 <code>.sra</code> 文件相同的目录中。</p>
<p>#!/usr/local/bin/python3</p>
<h1 id="coding-utf-8-1"><a href="#coding-utf-8-1" class="headerlink" title="-- coding: utf-8 --"></a>-<em>- coding: utf-8 -</em>-</h1><h1 id="Genomic-data-analysis-script-adjusted-for-processing-files-1-sra-to-68-sra"><a href="#Genomic-data-analysis-script-adjusted-for-processing-files-1-sra-to-68-sra" class="headerlink" title="Genomic data analysis script adjusted for processing files 1.sra to 68.sra"></a>Genomic data analysis script adjusted for processing files 1.sra to 68.sra</h1><p>import os, sys, glob, time, argparse, threading</p>
<h1 id="Setup-command-line-arguments"><a href="#Setup-command-line-arguments" class="headerlink" title="Setup command line arguments"></a>Setup command line arguments</h1><p>my_parser = argparse.ArgumentParser(description=’Genomic data analysis pipeline adjusted for specific .sra files’)<br>my_parser.add_argument(‘-t’, dest=’thread’, type=int, default=4, help=’Number of threads’)<br>my_parser.add_argument(‘-i’, dest=’input_dir’, default=’/home/data1/renminpeng/New1’, help=’Input directory containing .sra files’)<br>my_parser.add_argument(‘-r’, dest=’reference’, default=’/home/data1/renminpeng/New/reference.fasta’, help=’Reference genome file path’)<br>args = my_parser.parse_args()</p>
<h1 id="Create-a-time-log-file"><a href="#Create-a-time-log-file" class="headerlink" title="Create a time log file"></a>Create a time log file</h1><p>TimeTable = open(os.path.join(args.input_dir, ‘TimeTable.txt’), ‘w’)</p>
<p>ref = args.reference</p>
<h1 id="Define-output-directories"><a href="#Define-output-directories" class="headerlink" title="Define output directories"></a>Define output directories</h1><p>output_bam_dir = args.input_dir + ‘_bam_dir’<br>output_gvcf_dir = args.input_dir + ‘_gvcf_dir’<br>fastq_dir = args.input_dir + ‘_fastq’</p>
<h1 id="Check-and-create-output-directories-if-not-exist"><a href="#Check-and-create-output-directories-if-not-exist" class="headerlink" title="Check and create output directories if not exist"></a>Check and create output directories if not exist</h1><p>if not os.path.exists(output_bam_dir):<br>    os.makedirs(output_bam_dir)<br>if not os.path.exists(output_gvcf_dir):<br>    os.makedirs(output_gvcf_dir)<br>if not os.path.exists(fastq_dir):<br>    os.makedirs(fastq_dir)</p>
<h1 id="Function-for-parallel-processing"><a href="#Function-for-parallel-processing" class="headerlink" title="Function for parallel processing"></a>Function for parallel processing</h1><p>def mult(funct, ls, n=3):<br>    pool = []  # Thread pool<br>    length = len(ls)<br>    step = int(length / n) + 1<br>    for i in range(0, length, step):<br>        p = threading.Thread(target=funct, args=(ls[i: i + step],))<br>        pool.append(p)<br>    for p in pool:<br>        p.start()<br>    for p in pool:<br>        p.join()<br>    print(time.strftime(‘%Y-%m-%d %H:%M:%S’, time.localtime(time.time())) + ‘_Main thread STAR exiting’, file=TimeTable)<br>    TimeTable.flush()</p>
<h1 id="Convert-sra-to-fq-and-perform-alignment"><a href="#Convert-sra-to-fq-and-perform-alignment" class="headerlink" title="Convert .sra to .fq and perform alignment"></a>Convert .sra to .fq and perform alignment</h1><p>def sra_to_fq_and_bwa(sra_files):<br>    for sra_file in sra_files:<br>        sample_head = os.path.basename(sra_file).split(‘.’)[0]  # Assuming filename “1.sra”, sample_head would be “1”<br>        # Convert .sra to .fq.gz using fastq-dump<br>        fq1_path = os.path.join(fastq_dir, f”{sample_head}_1.fastq.gz”)<br>        fq2_path = os.path.join(fastq_dir, f”{sample_head}_2.fastq.gz”)<br>        os.system(f’fastq-dump –split-files –gzip –outdir {fastq_dir} {sra_file}’)<br>        # Check if FASTQ files were created<br>        if not os.path.exists(fq1_path) or not os.path.exists(fq2_path):<br>            sys.exit(f”Error converting {sra_file} to FASTQ format.”)<br>        # Execute BWA alignment, followed by processing steps<br>        bam_output = os.path.join(output_bam_dir, f”{sample_head}.bam”)<br>        # Ensure commands such as BWA, samtools are available in your environment<br>        os.system(f’bwa mem -M -t {args.thread} -R “@RG\tID:{sample_head}\tSM:{sample_head}\tPL:illumina\tLB:lib1\tPU:unit1” {ref} {fq1_path} {fq2_path} | samtools view -bhS - &gt; {bam_output}’)<br>        # Further processing steps can be adjusted here</p>
<h1 id="Prepare-a-list-of-sra-files-to-process"><a href="#Prepare-a-list-of-sra-files-to-process" class="headerlink" title="Prepare a list of .sra files to process"></a>Prepare a list of .sra files to process</h1><p>sra_files_to_process = [os.path.join(args.input_dir, f”{i}.sra”) for i in range(1, 69)]</p>
<h1 id="Process-sra-files"><a href="#Process-sra-files" class="headerlink" title="Process .sra files"></a>Process .sra files</h1><p>mult(sra_to_fq_and_bwa, sra_files_to_process, n=args.thread)</p>
<p>运行命令：python3 institute2_DNA_to_VCF1.4.py -t 8 -i /home/data1/renminpeng/New1 -r /home/data1/renminpeng/New/reference.fasta</p>
<p>上一步生成的bam_dir文件</p>
<p>然后</p>
<p>User<br>NCBI中的全基因组重测序文件有哪些类型？</p>
<p>NCBI (National Center for Biotechnology Information) 是一个重要的公共数据库，用于存储各类生物学数据，包括全基因组重测序（Whole Genome Sequencing, WGS）文件。全基因组重测序文件可以采用多种格式存储，每种格式都有其特定的用途和特点。以下是一些常见的全基因组重测序文件类型：</p>
<ol>
<li><p>**FASTA (.fasta 或 .fa)**：这是最基本的序列数据格式，用于存储核酸（DNA或RNA）序列或蛋白质序列。在全基因组重测序中，FASTA格式常用于存储参考序列或重测序后的拼接序列。</p>
</li>
<li><p>**FASTQ (.fastq)**：这种格式包含了序列（nucleotide sequences）及其对应的质量分数（quality scores）。FASTQ是原始测序数据的标准格式，广泛用于存储Illumina、SOLiD等下一代测序技术（Next-Generation Sequencing, NGS）的输出结果。</p>
</li>
<li><p>**SAM/BAM (.sam/.bam)**：序列比对/映射格式（Sequence Alignment/Map Format）和其二进制版本（Binary Alignment/Map）。SAM格式用于存储序列的比对信息，包括序列与参考基因组的对齐情况。BAM是SAM的压缩二进制格式，便于存储和快速访问。</p>
</li>
<li><p>**VCF (.vcf)**：变异调用格式（Variant Call Format），用于存储基因组变异数据，包括单核苷酸多态性（SNPs）、插入缺失（indels）等。VCF文件通常由比对工具（如SAMtools、GATK）生成，用于记录相对于参考基因组的变异信息。</p>
</li>
<li><p>**CRAM (.cram)**：CRAM是一种比BAM更加高效的序列数据压缩格式。它利用参考基因组来实现更高的压缩率，同时保留了与BAM相同的信息内容。</p>
</li>
<li><p>**GFF/GTF (.gff/.gtf)**：基因特征格式（Gene Feature Format）和基因转录格式（Gene Transfer Format）用于描述基因和其他基因组特征的位置和属性。</p>
</li>
</ol>
<p>这些文件类型各有用途，比如原始序列数据（FASTQ），比对结果（SAM/BAM/CRAM），以及变异信息（VCF）。NCBI提供的数据库和工具（如SRA、GenBank等）允许研究人员访问和下载这些不同类型的数据文件，以支持基因组学研究。</p>
<h2 id="vcf文件是不是最后一步？"><a href="#vcf文件是不是最后一步？" class="headerlink" title="vcf文件是不是最后一步？"></a>vcf文件是不是最后一步？</h2><p>VCF（Variant Call Format）文件通常出现在全基因组重测序分析流程的较后阶段，主要用于记录相对于参考基因组的变异信息，如单核苷酸多态性（SNPs）、插入缺失（indels）、复杂变异等。VCF文件的生成是变异检测分析的一个重要步骤，但是否是最后一步取决于具体的研究目标和分析流程。</p>
<p>在全基因组重测序的典型工作流程中，VCF文件的生成通常遵循以下步骤：</p>
<ol>
<li><strong>原始数据质控</strong>：使用如FastQC之类的工具对FASTQ格式的原始测序数据进行质量控制。</li>
<li><strong>序列比对</strong>：将测序得到的短序列（reads）与参考基因组进行比对，通常会使用如BWA或Bowtie之类的工具生成SAM/BAM格式文件。</li>
<li><strong>后处理</strong>：对比对结果进行排序、标记重复序列、重新比对以优化间隙区域等步骤，以提高变异检测的准确性。</li>
<li><strong>变异检测</strong>：分析比对结果，检测基因组变异，如SNPs和indels，通常使用如GATK、Samtools等工具生成VCF格式文件。</li>
</ol>
<p>在生成了VCF文件之后，可能还会进行以下分析：</p>
<ul>
<li><strong>变异过滤</strong>：根据质量分数、深度、变异频率等标准过滤变异，提高变异检测的准确性。</li>
<li><strong>变异注释</strong>：使用如ANNOVAR、SnpEff等工具对检测到的变异进行注释，包括变异对蛋白质功能的影响、变异在已知疾病中的角色等信息。</li>
<li><strong>变异效应预测</strong>：评估变异可能对基因或基因产物功能的影响，包括突变对蛋白结构和功能的潜在影响。</li>
<li><strong>统计分析和关联研究</strong>：对变异数据进行统计分析，探索变异与特定表型或疾病的关联。</li>
</ul>
<p>因此，虽然VCF文件的生成是分析流程中的一个关键步骤，但后续的过滤、注释、效应预测和统计分析等步骤同样重要，特别是在寻找与疾病相关的变异或进行基因组关联研究时。</p>
<h2 id="关系"><a href="#关系" class="headerlink" title="关系"></a>关系</h2><p>这些文件格式在全基因组重测序（WGS）分析流程中相互关联，每种格式在分析的不同阶段发挥作用。这些格式从原始数据的生成、处理、分析到结果的解释，构成了一个连续的数据处理流程。下面是这些文件格式之间关系的简要概述：</p>
<ol>
<li><p><strong>FASTQ</strong>：这是分析流程的起点，包含原始的测序读段（reads）及其质量分数。FASTQ文件通常是下一代测序（NGS）技术输出的直接产品，是后续分析的基础。</p>
</li>
<li><p><strong>FASTA</strong>：虽然FASTA格式不直接从FASTQ格式生成，但它在分析中扮演重要角色，通常作为参考基因组的存储格式。参考基因组是比对分析的基础，用于将测序读段映射回原来的位置。</p>
</li>
<li><p><strong>SAM/BAM</strong>：使用比对工具（如BWA、Bowtie等）将FASTQ文件中的读段比对到参考基因组（通常存储为FASTA格式）上，生成SAM格式文件。SAM文件是序列比对结果的文本表示，包含了读段与参考基因组的对应关系。由于SAM文件体积庞大，通常会被转换成BAM格式，后者是SAM的二进制压缩版本，便于存储和快速访问。</p>
</li>
<li><p><strong>CRAM</strong>：CRAM格式是BAM格式的一种更加高效的压缩形式，尤其在参考基因组已知的情况下，可以显著减少文件大小，同时保留了与BAM相同的信息内容。</p>
</li>
<li><p><strong>VCF</strong>：在比对（SAM/BAM/CRAM文件）的基础上，使用变异检测工具（如GATK、Samtools等）分析比对结果，识别基因组中的变异（SNPs、indels等），并将这些信息存储在VCF文件中。VCF文件代表了从原始测序数据到最终变异检测结果的转化。</p>
</li>
<li><p><strong>GFF/GTF</strong>：这些文件格式用于描述基因和其他基因组特征的位置和属性，常用于注释参考基因组或解释比对和变异检测结果。虽然GFF/GTF文件不直接从上述流程生成，但它们为理解基因组结构和功能、以及变异的生物学影响提供了重要信息。</p>
</li>
</ol>
<p>综上所述，FASTQ文件是分析的起点，包含原始测序数据；FASTA格式存储参考基因组，为读段比对提供基础；SAM/BAM/CRAM文件记录了读段与参考基因组的比对结果；VCF文件存储最终的变异检测结果；GFF/GTF文件则用于基因组特征的注释和描述。这些格式一起构成了从原始数据到最终结果的完整分析流程。</p>
<p>对于之前提及的全基因组测序数据处理步骤，这里提供一个更详细的解释：</p>
<ol>
<li><p><strong>质量控制</strong>：使用FastQC对原始的FASTQ格式测序数据进行质量评估，包括识别低质量的序列和可能的污染。这一步骤帮助确定数据是否适合进一步分析。</p>
</li>
<li><p><strong>序列比对</strong>：BWA是一个常用的比对工具，它将测序读段（FASTQ格式）比对到参考基因组（FASTA格式）。比对结果通常保存为SAM格式，这是一种文本格式，详细记录了每个读段与参考基因组的对应关系。</p>
</li>
<li><p><strong>SAM转BAM</strong>：SAM文件虽然易于阅读，但体积较大。使用Samtools将SAM格式转换为BAM格式，BAM是SAM的二进制版本，可以显著减小文件大小，便于存储和快速读取。</p>
</li>
<li><p><strong>排序BAM文件</strong>：对BAM文件进行排序是许多分析工具的前提条件。使用Samtools对BAM文件按照参考基因组的坐标进行排序。</p>
</li>
<li><p><strong>标记重复</strong>：重复的读段可能来自PCR扩增等实验过程。使用Picard工具标记重复的读段，有助于提高变异检测的准确性。</p>
</li>
<li><p><strong>创建BAM索引</strong>：为了快速访问BAM文件中的特定区域，需要为其创建索引文件。使用Samtools可以轻松完成这一步骤。</p>
</li>
<li><p><strong>变异检测</strong>：GATK工具的HaplotypeCaller功能用于从比对好的序列（BAM文件）中检测SNPs和indels等变异，结果保存在VCF文件中。</p>
</li>
</ol>
<p>每一步都需要相应的命令行工具和参数。这些步骤构成了从原始数据到变异检测的基本流程，但实际操作中可能需要根据具体情况调整参数或增加其他分析步骤。</p>
<p>对于具体的全基因组重测序数据分析示例，如处理鸡的全基因组数据，详细步骤会包括但不限于以下过程，每一步均需在命令行环境中执行：</p>
<ol>
<li><p><strong>质量控制</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastqc chicken_data.fastq -o output_dir</span><br></pre></td></tr></table></figure>
<p>使用FastQC对原始测序数据<code>chicken_data.fastq</code>进行质量评估，输出结果到指定目录<code>output_dir</code>。</p>
</li>
<li><p><strong>序列比对</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bwa mem reference_genome.fasta chicken_data.fastq &gt; chicken_aligned.sam</span><br></pre></td></tr></table></figure>
<p>使用BWA将数据<code>chicken_data.fastq</code>与参考基因组<code>reference_genome.fasta</code>进行比对，输出SAM文件<code>chicken_aligned.sam</code>。</p>
</li>
<li><p><strong>SAM转BAM</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">samtools view -S -b chicken_aligned.sam &gt; chicken_aligned.bam</span><br></pre></td></tr></table></figure>
<p>使用Samtools将SAM文件转换为BAM格式，便于后续处理。</p>
</li>
<li><p><strong>排序BAM文件</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">samtools sort chicken_aligned.bam -o chicken_sorted.bam</span><br></pre></td></tr></table></figure>
<p>对BAM文件进行排序，输出为<code>chicken_sorted.bam</code>。</p>
</li>
<li><p><strong>标记重复</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">picard MarkDuplicates I=chicken_sorted.bam O=chicken_dedup.bam M=dup_metrics.txt</span><br></pre></td></tr></table></figure>
<p>使用Picard工具标记BAM文件中的重复读段，输出去重后的BAM文件<code>chicken_dedup.bam</code>和重复度量文件<code>dup_metrics.txt</code>。</p>
</li>
<li><p><strong>创建BAM索引</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">samtools index chicken_dedup.bam</span><br></pre></td></tr></table></figure>
<p>为去重后的BAM文件创建索引，以便快速访问。</p>
</li>
<li><p><strong>变异检测</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gatk HaplotypeCaller -R reference_genome.fasta -I chicken_dedup.bam -O chicken_variants.vcf</span><br></pre></td></tr></table></figure>
<p>使用GATK的HaplotypeCaller对去重后的BAM文件进行变异检测，输出VCF文件<code>chicken_variants.vcf</code>。</p>
</li>
</ol>
<p>请注意，这些命令只是一般性示例，实际使用时需要根据具体情况（如文件路径、参考基因组的确切名称等）进行调整。此外，每个步骤可能需要安装相应的软件和库。</p>
<p>如果有多个chicken_data.fastq格式的文件呢？</p>
<p>如果有多个<code>chicken_data.fastq</code>格式的文件，可以使用循环或合并策略处理这些文件。一个常见的方法是首先对每个文件进行序列比对，然后将所有的BAM文件合并，以进行后续分析。以下是处理多个文件的示例步骤：</p>
<ol>
<li>对每个FASTQ文件运行BWA进行比对，生成多个SAM文件。</li>
<li>将每个SAM文件转换为BAM格式，并对每个BAM文件进行排序。</li>
<li>使用<code>samtools merge</code>命令合并所有排序后的BAM文件。</li>
<li>对合并后的BAM文件标记重复并创建索引。</li>
<li>进行变异检测。</li>
</ol>
<p>例如，假设有两个文件<code>chicken_data_1.fastq</code>和<code>chicken_data_2.fastq</code>，合并步骤可能如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 步骤1-4: 对每个文件重复执行前述步骤</span></span><br><span class="line"><span class="comment"># 合并排序后的BAM文件</span></span><br><span class="line">samtools merge combined_sorted.bam chicken_sorted_1.bam chicken_sorted_2.bam</span><br><span class="line"></span><br><span class="line"><span class="comment"># 标记重复</span></span><br><span class="line">picard MarkDuplicates I=combined_sorted.bam O=combined_dedup.bam M=combined_dup_metrics.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建索引</span></span><br><span class="line">samtools index combined_dedup.bam</span><br><span class="line"></span><br><span class="line"><span class="comment"># 变异检测</span></span><br><span class="line">gatk HaplotypeCaller -R reference_genome.fasta -I combined_dedup.bam -O combined_variants.vcf</span><br></pre></td></tr></table></figure>

<p>这只是一个基本的处理流程。实际应用中，可能需要根据具体的项目需求和数据量调整这个流程。</p>
<p><a target="_blank" rel="noopener" href="https://bmcgenomics.biomedcentral.com/articles/10.1186/s12864-022-08598-2">https://bmcgenomics.biomedcentral.com/articles/10.1186/s12864-022-08598-2</a></p>
<p>在Galbase平台上找到全面的鸡全基因组重测序数据进行分析。Galbase整合了从公共资源（如NCBI序列读取存档）收集的多组学数据，提供了928个重测序基因组及相关组学数据集。这个资源旨在支持鸡的广泛基因组和遗传研究。</p>
<p>TBtools | 基因组重测序数据分析常用上游软件「三兄弟」，聚齐了~</p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/a98b3b69bcfe">https://www.jianshu.com/p/a98b3b69bcfe</a></p>
<p>当然，我可以向你说明如何在NCBI（美国国家生物技术信息中心）中搜索鸡（Gallus gallus）的全基因组重测序数据的步骤。NCBI 提供了多个数据库来存储不同类型的生物信息数据，对于全基因组重测序数据，通常可以在 SRA（序列读取档案）数据库中找到。以下是步骤：</p>
<h3 id="1-访问-NCBI-主页"><a href="#1-访问-NCBI-主页" class="headerlink" title="1. 访问 NCBI 主页"></a>1. 访问 NCBI 主页</h3><ul>
<li>打开你的网络浏览器，访问 <a target="_blank" rel="noopener" href="https://www.ncbi.nlm.nih.gov/">NCBI 主页</a>。</li>
</ul>
<h3 id="2-进入-SRA-数据库"><a href="#2-进入-SRA-数据库" class="headerlink" title="2. 进入 SRA 数据库"></a>2. 进入 SRA 数据库</h3><ul>
<li>在 NCBI 主页的搜索框中，有一个下拉菜单允许你选择不同的数据库。选择 “SRA” 选项。</li>
<li>在搜索框中输入 <code>Gallus gallus</code> 或者 <code>chicken</code>，然后点击搜索图标或按回车键。</li>
</ul>
<h3 id="3-精确化搜索"><a href="#3-精确化搜索" class="headerlink" title="3. 精确化搜索"></a>3. 精确化搜索</h3><ul>
<li>搜索结果出现后，你可能会看到大量的记录。为了精确地找到全基因组重测序数据，可以在搜索框中添加额外的关键词，如 <code>genome sequencing</code>、<code>whole genome resequencing</code> 或 <code>WGS</code>。</li>
<li>例如，你可以输入 <code>Gallus gallus whole genome resequencing</code> 或 <code>chicken WGS</code>。</li>
</ul>
<h3 id="4-使用过滤器"><a href="#4-使用过滤器" class="headerlink" title="4. 使用过滤器"></a>4. 使用过滤器</h3><ul>
<li>搜索结果页面通常会提供过滤器，以帮助你进一步缩小搜索范围。你可以按照发布日期、研究类型（如 “其他” 或 “基因组学”）、来源（如 “多细胞生物”）等条件来过滤搜索结果。</li>
</ul>
<h3 id="5-选择和查看数据集"><a href="#5-选择和查看数据集" class="headerlink" title="5. 选择和查看数据集"></a>5. 选择和查看数据集</h3><ul>
<li>浏览搜索结果，点击感兴趣的记录标题查看详情。</li>
<li>每个数据集的页面都会提供关于该数据集的详细信息，包括摘要、出版信息、数据访问和下载选项。</li>
</ul>
<h3 id="6-下载数据"><a href="#6-下载数据" class="headerlink" title="6. 下载数据"></a>6. 下载数据</h3><ul>
<li>根据你的需求，你可以下载整个数据集或部分数据。SRA 数据库提供了多种下载选项，包括直接下载和使用 NCBI 的 SRA Toolkit 工具。</li>
<li>如果你不熟悉如何使用 SRA Toolkit，NCBI 提供了详细的使用指南和教程。</li>
</ul>
<p>以上就是在 NCBI 中搜索鸡的全基因组重测序数据的基本步骤。请注意，随着 NCBI 网站的更新和改进，具体的操作步骤可能会有所变化。如果你在搜索或下载数据时遇到任何问题，建议查阅 NCBI 的帮助文档或联系他们的客服支持。</p>
<p>是的，全基因组测序数据（WGS, Whole Genome Sequencing）确实可以在 NCBI 的 SRA（Sequence Read Archive）数据库中找到。SRA 存储了来自高通量测序平台的原始测序数据和质量信息，这包括了不仅限于全基因组测序数据，还有转录组测序（RNA-Seq）、表观基因组测序（如ChIP-Seq）、以及其他各种测序技术产生的数据。</p>
<p>对于寻找全基因组测序数据，SRA 提供了一个丰富的资源库，其中包含了许多物种的全基因组数据。用户可以通过使用特定的搜索关键词（例如物种名称加上 “whole genome sequencing” 或 “WGS”）来查找目标物种的全基因组数据。此外，SRA 的高级搜索和过滤功能也可以帮助用户更精确地定位到所需的数据集。</p>
<p>一旦找到感兴趣的数据集，用户可以查看数据的详细信息，包括实验设计、样本信息和下载选项。NCBI 还提供了SRA Toolkit，这是一套命令行工具，用于下载、转换和分析SRA中的数据。这些工具可以帮助用户更高效地处理和分析数据，以支持他们的科研项目。</p>
<p>User</p>
<h2 id="NCBI-SRA数据库，下载的sra文件，基因组数据，和转录组数据的sra，转换成fastq格式，他们的方法一样吗？"><a href="#NCBI-SRA数据库，下载的sra文件，基因组数据，和转录组数据的sra，转换成fastq格式，他们的方法一样吗？" class="headerlink" title="NCBI,SRA数据库，下载的sra文件，基因组数据，和转录组数据的sra，转换成fastq格式，他们的方法一样吗？"></a>NCBI,SRA数据库，下载的sra文件，基因组数据，和转录组数据的sra，转换成fastq格式，他们的方法一样吗？</h2><p>NCBI SRA (Sequence Read Archive) 数据库是一个公共资源，用于存储来自世界各地的生物科学研究中产生的序列数据。这些数据可以包括基因组数据、转录组数据等。SRA 文件可以转换为更为通用的 FASTQ 格式，以便进行进一步的分析。基因组数据和转录组数据虽然来源不同，但他们从 SRA 格式转换到 FASTQ 格式的基本方法是相同的。</p>
<p>转换 SRA 文件到 FASTQ 格式，通常使用 NCBI 的 <code>fastq-dump</code> 工具，这是 SRA Toolkit 的一部分。以下是一个基本的转换步骤：</p>
<ol>
<li><p><strong>下载 SRA Toolkit</strong>：首先，需要从 NCBI 的网站下载并安装 SRA Toolkit。</p>
</li>
<li><p><strong>使用 <code>fastq-dump</code> 转换 SRA 到 FASTQ</strong>：接下来，使用 <code>fastq-dump</code> 命令行工具将 SRA 文件转换成 FASTQ 格式。这一步对于基因组数据和转录组数据来说是一样的。</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastq-dump --split-files &lt;sra_file_path&gt;</span><br></pre></td></tr></table></figure>

<p> 这里的 <code>--split-files</code> 参数用于处理那些包含成对测序读取的 SRA 文件，确保成对的读取会被分割到不同的文件中。</p>
</li>
<li><p><strong>其它参数</strong>：<code>fastq-dump</code> 还有其他参数可以根据需要使用，比如 <code>--gzip</code> 用于压缩输出的 FASTQ 文件，以节省空间。</p>
</li>
</ol>
<p>尽管基因组和转录组数据的来源不同，但从技术角度看，将它们从 SRA 格式转换为 FASTQ 格式的过程是一样的。重要的是要了解你的数据类型（如单端或双端），以便在转换过程中使用正确的参数，确保数据正确处理。对于更复杂的需求，比如只提取特定区域的读取或处理非常大的数据集，SRA Toolkit 提供了其他工具和参数来支持这些高级功能。</p>
<p>使用GATK（Genome Analysis Toolkit）和Picard的<code>MarkDuplicates</code>模块来标记PCR重复是生物信息学数据分析中的一个重要步骤，尤其是在处理高通量测序（HTS）数据时。PCR重复是指因PCR扩增过程中的偏好性扩增或样本制备过程中的其他原因导致的序列重复。标记这些重复是非常重要的，因为它们可以人为地增加特定序列的覆盖度，从而影响变异检测和其他分析的准确性。</p>
<h3 id="Picard-MarkDuplicates"><a href="#Picard-MarkDuplicates" class="headerlink" title="Picard MarkDuplicates"></a>Picard MarkDuplicates</h3><p>在Picard工具中，<code>MarkDuplicates</code>被用来标记BAM或SAM文件中的重复序列，但不会实际删除这些重复。用户可以选择在后续分析中忽略这些标记为重复的序列。</p>
<p>下面是一个使用Picard <code>MarkDuplicates</code>的命令行示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">picard MarkDuplicates I=chicken_sorted.bam O=chicken_dedup.bam M=dup_metrics.txt</span><br></pre></td></tr></table></figure>

<p>这个命令的参数意义如下：</p>
<ul>
<li><code>I=chicken_sorted.bam</code>：输入文件，必须是排序过的BAM文件。</li>
<li><code>O=chicken_dedup.bam</code>：输出文件，其中重复将被标记（不是删除）。</li>
<li><code>M=dup_metrics.txt</code>：输出的重复指标文件，包含了关于识别出的重复的统计信息。</li>
</ul>
<h3 id="GATK-MarkDuplicates"><a href="#GATK-MarkDuplicates" class="headerlink" title="GATK MarkDuplicates"></a>GATK MarkDuplicates</h3><p>GATK的<code>MarkDuplicates</code>功能类似于Picard的，因为GATK的很多工具实际上是建立在Picard工具包之上的。GATK4开始提供了一个自己的<code>MarkDuplicates</code>工具，其语法和Picard非常相似，但是集成在了GATK的框架中。GATK的版本通常通过命令行界面的<code>gatk</code>命令调用。</p>
<p>如果你使用的是GATK来标记重复，你需要确保已经安装了GATK，并且按照它的要求准备好了环境。GATK的命令行可能看起来像这样：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gatk MarkDuplicates -I chicken_sorted.bam -O chicken_dedup.bam -M dup_metrics.txt</span><br></pre></td></tr></table></figure>

<p>在GATK命令中，参数前缀通常是一个短划线<code>-</code>，而Picard则是直接使用等号<code>=</code>。其他的参数意义和Picard中的类似。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>选择使用Picard还是GATK的<code>MarkDuplicates</code>主要取决于你的工作流程以及你对工具的熟悉程度。两者在功能上是非常相似的，但GATK可能提供了一些额外的集成和便利性，特别是如果你已经在使用GATK进行其他分析的情况下。重要的是要确保输入的BAM文件是排序过的，以便工具能正确地标记重复序列。</p>
<p>我之前提供的GATK <code>MarkDuplicates</code>使用示例是一个基本的示例，而您提供的命令行示例展示了更多的选项和参数设置，使其能够更精细地控制过程并适应具体的系统资源。这个示例同样使用GATK来标记重复，但包含了一些高级配置，让我们来详细解析这个命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">java -Xmx20g -XX:ParallelGCThreads=8 -jar gatk-package-4.1.3.0-local.jar MarkDuplicates \</span><br><span class="line">    --REMOVE_DUPLICATES false --MAX_FILE_HANDLES 1000 \</span><br><span class="line">    --INPUT sample1.sorted.bam \</span><br><span class="line">    --OUTPUT sample1.sorted.mkdup.bam \</span><br><span class="line">    --METRICS_FILE sample1.sorted.mkdup_metrics.txt</span><br><span class="line">samtools index -@ 5 sample1.sorted.mkdup.bam</span><br></pre></td></tr></table></figure>

<ol>
<li><p><strong>Java Virtual Machine (JVM) 设置</strong>:</p>
<ul>
<li><code>java -Xmx20g</code>：这个参数设置JVM最大堆内存为20GB，确保有足够的内存来处理文件。</li>
<li><code>-XX:ParallelGCThreads=8</code>：这个参数设置垃圾收集器使用的线程数为8，可以根据你的系统的CPU核心数来调整以获得最佳性能。</li>
</ul>
</li>
<li><p><strong>GATK MarkDuplicates 参数</strong>:</p>
<ul>
<li><code>-jar gatk-package-4.1.3.0-local.jar</code>：指定了GATK的jar文件，这是运行GATK工具的主程序。</li>
<li><code>MarkDuplicates</code>：指定要运行的工具是MarkDuplicates。</li>
<li><code>--REMOVE_DUPLICATES false</code>：告诉程序不要从输出文件中删除重复的读取，而是仅仅标记它们。这是因为在某些情况下，保留这些重复的读取对于后续分析可能是有用的。</li>
<li><code>--MAX_FILE_HANDLES 1000</code>：设置打开文件的句柄的最大数量。这有助于减少磁盘I/O，对于处理大型数据集特别有用。</li>
<li><code>--INPUT sample1.sorted.bam</code>：输入的BAM文件。</li>
<li><code>--OUTPUT sample1.sorted.mkdup.bam</code>：输出的BAM文件，在这个文件中，重复将被标记。</li>
<li><code>--METRICS_FILE sample1.sorted.mkdup_metrics.txt</code>：输出的指标文件，包含了关于识别出的重复的统计信息。</li>
</ul>
</li>
<li><p><strong>Samtools 索引</strong>:</p>
<ul>
<li><code>samtools index -@ 5 sample1.sorted.mkdup.bam</code>：在标记重复后，使用samtools为输出的BAM文件创建索引。<code>-@ 5</code>参数指定使用5个线程来加速索引过程。</li>
</ul>
</li>
</ol>
<p>这个命令行示例展示了如何使用GATK的<code>MarkDuplicates</code>工具以及如何为输出文件创建索引，同时也展示了如何通过JVM参数来优化性能。每个选项和参数的选择都可以根据你的具体需求和系统资源来调整。</p>
<h2 id="在比较GATK和Picard的MarkDuplicates命令时，要注意的是，这两个工具在很多方面是相似的，因为GATK的MarkDuplicates是基于Picard的代码开发的。然而，每个工具都有其特定的使用场景和优势。选择哪个更好通常取决于几个因素，包括你的特定需求、工作流程的其他组件以及你对工具的熟悉程度。"><a href="#在比较GATK和Picard的MarkDuplicates命令时，要注意的是，这两个工具在很多方面是相似的，因为GATK的MarkDuplicates是基于Picard的代码开发的。然而，每个工具都有其特定的使用场景和优势。选择哪个更好通常取决于几个因素，包括你的特定需求、工作流程的其他组件以及你对工具的熟悉程度。" class="headerlink" title="在比较GATK和Picard的MarkDuplicates命令时，要注意的是，这两个工具在很多方面是相似的，因为GATK的MarkDuplicates是基于Picard的代码开发的。然而，每个工具都有其特定的使用场景和优势。选择哪个更好通常取决于几个因素，包括你的特定需求、工作流程的其他组件以及你对工具的熟悉程度。"></a>在比较GATK和Picard的<code>MarkDuplicates</code>命令时，要注意的是，这两个工具在很多方面是相似的，因为GATK的<code>MarkDuplicates</code>是基于Picard的代码开发的。然而，每个工具都有其特定的使用场景和优势。选择哪个更好通常取决于几个因素，包括你的特定需求、工作流程的其他组件以及你对工具的熟悉程度。</h2><h3 id="GATK-MarkDuplicates-1"><a href="#GATK-MarkDuplicates-1" class="headerlink" title="GATK MarkDuplicates"></a>GATK <code>MarkDuplicates</code></h3><ul>
<li><strong>集成度</strong>：GATK提供了一个广泛的分析工具集合，包括变异检测、基因组注释等。如果你的工作流程大量依赖GATK的其他工具，使用GATK的<code>MarkDuplicates</code>可以更方便地集成。</li>
<li><strong>性能优化</strong>：GATK经常更新，包括性能优化和新功能的添加。使用最新版本的GATK可能会带来性能上的优势。</li>
<li><strong>资源管理</strong>：GATK提供的命令行选项允许对内存使用和并行处理进行更细致的控制，这对于处理大规模数据集特别重要。</li>
</ul>
<h3 id="Picard-MarkDuplicates-1"><a href="#Picard-MarkDuplicates-1" class="headerlink" title="Picard MarkDuplicates"></a>Picard <code>MarkDuplicates</code></h3><ul>
<li><strong>稳定性和可靠性</strong>：Picard是一个成熟的工具，长期以来一直被广泛使用于生物信息学社区。它的稳定性和可靠性是经过验证的。</li>
<li><strong>简易性</strong>：对于只需进行重复标记而不需要其他复杂分析的用户来说，Picard可能是一个更简单的选择。它直接提供了一个易于理解的命令行界面。</li>
<li><strong>社区支持</strong>：Picard有一个活跃的社区，用户可以轻松找到使用技巧和最佳实践。</li>
</ul>
<h3 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h3><ul>
<li>如果你的工作流程涉及到GATK的其他分析工具，或者你需要进行高级的性能调优，GATK的<code>MarkDuplicates</code>可能是更好的选择。</li>
<li>如果你需要一个稳定、可靠且易于使用的重复标记工具，或者你已经熟悉Picard工具集，Picard的<code>MarkDuplicates</code>可能更适合你。</li>
</ul>
<p>总的来说，没有一个工具在所有情况下都是最好的。最佳选择取决于你的具体需求、数据大小、以及个人偏好。在决定之前，你可能还需要考虑实验一下两种工具，看看哪个在你的特定数据集和分析流程中表现更好。</p>
<p>在Linux环境下安装Picard和GATK涉及到几个步骤，通常包括获取软件包、设置环境变量以及确认Java环境（因为两者都是Java程序）。以下是一个基本的安装指南：</p>
<h3 id="安装Java"><a href="#安装Java" class="headerlink" title="安装Java"></a>安装Java</h3><p>因为Picard和GATK都是Java程序，所以首先确保你的系统中安装了Java。大多数Linux发行版允许你通过包管理器来安装Java。例如，在基于Debian的系统中，你可以使用apt：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install default-jdk</span><br></pre></td></tr></table></figure>

<p>在安装Java后，通过运行<code>java -version</code>来验证安装是否成功。</p>
<h3 id="安装Picard"><a href="#安装Picard" class="headerlink" title="安装Picard"></a>安装Picard</h3><ol>
<li><p><strong>下载Picard工具</strong>：</p>
<ul>
<li>访问<a target="_blank" rel="noopener" href="https://github.com/broadinstitute/picard/releases">Picard的GitHub发布页面</a>来下载最新版本的<code>.jar</code>文件。</li>
</ul>
</li>
<li><p><strong>运行Picard</strong>：</p>
<ul>
<li>一旦下载完毕，你可以直接使用Java运行下载的jar文件。例如：<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar picard.jar MarkDuplicates I=input.bam O=output.bam M=metrics.txt</span><br></pre></td></tr></table></figure></li>
<li>你可能想把Picard的<code>.jar</code>文件移动到一个全局可访问的位置，并设置一个别名，以便更容易地运行。</li>
</ul>
</li>
</ol>
<h3 id="安装GATK"><a href="#安装GATK" class="headerlink" title="安装GATK"></a>安装GATK</h3><ol>
<li><p><strong>下载GATK</strong>：</p>
<ul>
<li>访问<a target="_blank" rel="noopener" href="https://software.broadinstitute.org/gatk/download/">GATK的官方网站</a>或<a target="_blank" rel="noopener" href="https://github.com/broadinstitute/gatk/releases">GATK的GitHub发布页面</a>下载最新版本的GATK。你需要注册一个免费账户才能下载GATK。</li>
</ul>
</li>
<li><p><strong>解压和设置环境变量</strong>：</p>
<ul>
<li>解压下载的GATK包，并可选地设置环境变量，以便在任何地方运行GATK。例如，如果你解压GATK到<code>/opt/gatk</code>，可以在你的<code>.bashrc</code>或<code>.bash_profile</code>中添加以下行：<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> GATK_HOME=/opt/gatk</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$GATK_HOME</span></span><br></pre></td></tr></table></figure></li>
<li>之后，你可以通过在命令行中简单地输入<code>gatk</code>来运行GATK。</li>
</ul>
</li>
<li><p><strong>运行GATK</strong>：</p>
<ul>
<li>使用GATK时，通常的命令格式是：<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gatk --java-options <span class="string">&quot;-Xmx4g&quot;</span> ToolName -OPTION value</span><br></pre></td></tr></table></figure></li>
<li>例如，使用GATK的<code>MarkDuplicates</code>：<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gatk --java-options <span class="string">&quot;-Xmx4g&quot;</span> MarkDuplicates -I input.bam -O output.bam -M metrics.txt</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ol>
<h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><ul>
<li><strong>环境变量</strong>：在<code>.bashrc</code>或<code>.bash_profile</code>中设置环境变量可以让你在任何目录下运行Picard和GATK，无需指定完整路径。</li>
<li><strong>内存分配</strong>：<code>--java-options &quot;-Xmx4g&quot;</code>这部分是用于给Java虚拟机分配最大内存的，<code>4g</code>代表4GB。根据你机器的实际内存大小和分析需求，这个值可以调整。</li>
</ul>
<p>通过以上步骤，你应该能够在Linux系统中成功安装和运行Picard和GATK。对于具体的工具使用方法，建议参考各自的官方文档，因为那里会有最详细的选项和使用场景介绍。</p>
<p>java -Xmx20g -XX:ParallelGCThreads=8 -jar gatk-package-4.1.3.0-local.jar HaplotypeCaller <br>    -R genome.fa –emit-ref-confidence GVCF <br>    -L g_1.bed -variant_index_type LINEAR -variant_index_parameter 128000 -mbq 20 <br>    -I sample1.sorted.mkdup.bam <br>    -O sample1.g_1.gvcf.gz</p>
<p>解释一下这个</p>
<p>这条命令是使用GATK（Genome Analysis Toolkit）中的HaplotypeCaller工具来调用基因组中的变异。GATK是一个软件包，用于分析高通量测序数据。HaplotypeCaller是用于发现单核苷酸多态性(SNPs)和插入缺失(indels)的工具。下面是这条命令各部分的详细解释：</p>
<ul>
<li><p><code>java -Xmx20g -XX:ParallelGCThreads=8</code>: 这是Java虚拟机(JVM)的参数。<code>-Xmx20g</code>指定JVM最多可以使用的内存量为20GB。<code>-XX:ParallelGCThreads=8</code>设置垃圾收集器在执行并行阶段时使用的线程数为8。</p>
</li>
<li><p><code>-jar gatk-package-4.1.3.0-local.jar</code>: 使用<code>-jar</code>选项来运行GATK的jar文件。这里使用的GATK版本是4.1.3.0。</p>
</li>
<li><p><code>HaplotypeCaller</code>: 指定运行GATK中的HaplotypeCaller工具。</p>
</li>
<li><p><code>-R genome.fa</code>: <code>-R</code>指定参考基因组的路径，这里是<code>genome.fa</code>。</p>
</li>
<li><p><code>--emit-ref-confidence GVCF</code>: 这个选项让HaplotypeCaller输出GVCF（Genomic VCF）格式的文件，这种格式包含了每个基因座的置信度信息，适合于后续的联合基因型分析。</p>
</li>
<li><p><code>-L g_1.bed</code>: <code>-L</code>指定区间文件，HaplotypeCaller将只对这些区间内的基因组进行变异调用。<code>g_1.bed</code>是指定的区间文件。</p>
</li>
<li><p><code>-variant_index_type LINEAR</code> 和 <code>-variant_index_parameter 128000</code>: 这两个选项一起用来设置变异数据索引的类型和参数。<code>LINEAR</code>指定了索引的类型，<code>128000</code>是与索引类型相关的参数。</p>
</li>
<li><p><code>-mbq 20</code>: <code>-mbq</code>（minimum base quality）指定了最低碱基质量分数，低于此分数的碱基将不被考虑在内。这里设置为20。</p>
</li>
<li><p><code>-I sample1.sorted.mkdup.bam</code>: <code>-I</code>指定输入文件，这里是经过排序和标记重复之后的BAM文件<code>sample1.sorted.mkdup.bam</code>。</p>
</li>
<li><p><code>-O sample1.g_1.gvcf.gz</code>: <code>-O</code>指定输出文件，这里是输出的GVCF文件<code>sample1.g_1.gvcf.gz</code>，使用gzip压缩。</p>
</li>
</ul>
<p>总的来说，这条命令是运行GATK的HaplotypeCaller工具，使用了20GB的最大内存和8个并行垃圾收集线程，对<code>sample1.sorted.mkdup.bam</code>文件中的样本，在<code>g_1.bed</code>指定的区间内，基于<code>genome.fa</code>参考基因组，调用变异并输出为GVCF格式的<code>sample1.g_1.gvcf.gz</code>文件。</p>
<h2 id="L-g-1-bed，这个文件也要输入的吗？怎么获得，删掉可以吗"><a href="#L-g-1-bed，这个文件也要输入的吗？怎么获得，删掉可以吗" class="headerlink" title="-L g_1.bed，这个文件也要输入的吗？怎么获得，删掉可以吗"></a>-L g_1.bed，这个文件也要输入的吗？怎么获得，删掉可以吗</h2><p>是的，<code>-L g_1.bed</code>指定的<code>g_1.bed</code>文件是一个区间文件，用于告诉HaplotypeCaller只对参考基因组中特定的区间进行变异检测。这样做可以减少计算量，尤其是在只对基因组中的某些特定区域感兴趣时非常有用。</p>
<h3 id="如何获得BED文件？"><a href="#如何获得BED文件？" class="headerlink" title="如何获得BED文件？"></a>如何获得BED文件？</h3><p>BED（Browser Extensible Data）文件是一种保存着基因组数据区间信息的简单文本文件。它通常包含至少三列：染色体名（chromosome），起始位置（start position，基于0的计数），和结束位置（end position，不包含在区间内）。</p>
<p>BED文件可以通过多种方式获得：</p>
<ul>
<li>从公共数据库下载，如UCSC Genome Browser、ENSEMBL等。</li>
<li>使用生物信息学软件或自定义脚本根据研究需求生成。</li>
<li>从文献或合作伙伴处获取特定研究所用的BED文件。</li>
</ul>
<h3 id="删掉可以吗？"><a href="#删掉可以吗？" class="headerlink" title="删掉可以吗？"></a>删掉可以吗？</h3><p>如果不包括<code>-L</code>参数，HaplotypeCaller将对整个参考基因组进行变异检测，而不是只在BED文件指定的区间内。这将会增加分析的时间和资源消耗，但如果你希望对整个基因组进行分析，或者不关心特定的基因区域，可以省略这个参数。</p>
<p>在某些情况下，全基因组分析（WGA）是所需的，特别是当你需要全面了解样本的变异情况时。然而，这会使得计算更加密集和时间消耗更长。如果你的研究只关注基因组中的特定区域，保留这个参数并使用一个精确定义的BED文件会更加高效。</p>
<p>因此，是否删除<code>-L</code>参数取决于你的具体需求和研究目标。</p>
<h2 id="variant-index-type-LINEAR-和-variant-index-parameter-128000-这两个选项一起用来设置变异数据索引的类型和参数。LINEAR指定了索引的类型，128000是与索引类型相关的参数。"><a href="#variant-index-type-LINEAR-和-variant-index-parameter-128000-这两个选项一起用来设置变异数据索引的类型和参数。LINEAR指定了索引的类型，128000是与索引类型相关的参数。" class="headerlink" title="-variant_index_type LINEAR 和 -variant_index_parameter 128000: 这两个选项一起用来设置变异数据索引的类型和参数。LINEAR指定了索引的类型，128000是与索引类型相关的参数。"></a>-variant_index_type LINEAR 和 -variant_index_parameter 128000: 这两个选项一起用来设置变异数据索引的类型和参数。LINEAR指定了索引的类型，128000是与索引类型相关的参数。</h2><p>这里128000是什么意思</p>
<p>在GATK的<code>HaplotypeCaller</code>命令中，<code>-variant_index_type</code>和<code>-variant_index_parameter</code>这两个选项一起用于配置产生的变异数据(VCF文件)的索引。</p>
<p><code>-variant_index_type LINEAR</code>指的是索引类型为线性索引。GATK支持两种类型的索引：线性(<code>LINEAR</code>)和间隔树(<code>INTERVAL_TREE</code>)。线性索引适合于变异较少的场景，而间隔树索引适合于变异较多的场景。</p>
<p><code>-variant_index_parameter 128000</code>中的<code>128000</code>是与线性索引类型相关的参数，它指定了索引的粒度。在这种情况下，<code>128000</code>意味着每128,000个碱基建立一个索引点。这个参数影响着索引文件的大小和访问索引时的效率：较大的值会减小索引文件的大小，但可能会增加查找特定变异所需的时间；较小的值会使索引更加精细，提高查找效率，但会增加索引文件的大小。</p>
<p>选择这个参数值时，需要在索引文件的大小和查询效率之间做出权衡。<code>128000</code>是GATK推荐的一个平衡值，适用于多数情况。如果你的应用场景对索引性能有特别的要求，可能需要调整这个值。</p>
<p>你遇到的错误信息<code>A USER ERROR has occurred: v is not a recognized option</code>表明你使用的命令中有不被识别的选项，特别是关于<code>-variant_index_type</code>和<code>-variant_index_parameter</code>选项的使用。看起来这些选项在你使用的GATK版本（4.1.8.1）中不被识别。</p>
<p>根据我最后更新的信息，GATK 4版本及更高版本已经简化了变异索引的管理，移除了这些选项，或者已经以不需要用户指定的方式将它们的功能整合到了工具中。这意味着在使用HaplotypeCaller进行变异调用时，你不再需要手动指定变异索引的类型和参数。</p>
<p>这里是如何调整你的命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -Xmx20g -XX:ParallelGCThreads=8 -jar gatk-package-4.1.8.1-local.jar HaplotypeCaller -R reference.fasta --emit-ref-confidence GVCF -mbq 20 -I output_markerd_chongfu.bam -O sample1.g_1.gvcf.gz</span><br></pre></td></tr></table></figure>

<p>这个修正后的命令移除了<code>-variant_index_type</code>和<code>-variant_index_parameter</code>选项，这应该可以解决你遇到的错误。</p>
<p>GATK团队定期对工具进行优化和简化，始终检查特定版本的文档或使用<code>--help</code>选项来获取最新的命令和选项信息是一个好习惯。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">samtools faidx reference.fasta</span><br><span class="line"></span><br><span class="line">java -jar picard.jar CreateSequenceDictionary R=reference.fasta O=reference.dict</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>在基因组学和生物信息学分析中，术语“单样本”和“多样本”通常用来描述分析过程中考虑的样本数量。</p>
<h3 id="单样本-Single-sample"><a href="#单样本-Single-sample" class="headerlink" title="单样本 (Single-sample)"></a>单样本 (Single-sample)</h3><p>单样本分析是指每次处理或分析的是来自一个个体的基因组数据。在这种情况下，分析的目的通常是识别该个体的基因变异，包括单核苷酸多态性（SNPs）、插入和缺失（indels）等。单样本分析可以帮助确定个体的基因型，发现可能与疾病相关的变异，或者用于个体化医疗。</p>
<p>例如，使用GATK的HaplotypeCaller工具对一个人的基因组测序数据进行变异调用时，就是一个单样本分析的例子。</p>
<h3 id="多样本-Multi-sample"><a href="#多样本-Multi-sample" class="headerlink" title="多样本 (Multi-sample)"></a>多样本 (Multi-sample)</h3><p>多样本分析是指同时处理来自多个个体的基因组数据。这种分析可以在多个层面进行，包括对多个个体的数据进行联合变异调用，群体遗传学分析，以及用于研究种群遗传结构、基因频率、连锁不平衡、基因流等。</p>
<p>在多样本分析中，可以对多个样本的数据进行汇总分析，以识别群体中共有的或特异的变异，评估遗传多样性，或者探索特定变异在不同个体或群体中的分布情况。</p>
<p>例如，使用GATK的GenotypeGVCFs工具对多个个体的gVCF文件进行联合基因型分析，就是一个多样本分析的例子。这种分析可以提高变异检测的准确性和灵敏度，因为它允许研究者比较和对照多个样本，以更好地区分遗传变异和测序或处理过程中产生的假阳性。</p>
<h3 id="总结-2"><a href="#总结-2" class="headerlink" title="总结"></a>总结</h3><p>单样本和多样本分析各有其应用和优势。单样本分析专注于个体的遗传特征，而多样本分析通过比较多个样本提供更广阔的遗传视角，可以揭示遗传变异在种群中的分布和遗传病的共性特征。选择哪种分析方法取决于研究的目的和可用的样本数量。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">java -jar /home/data1/renminpeng/SRR2131201/gatk-4.1.8.1/gatk-package-4.1.8.1-local.jar HaplotypeCaller -R /home/data1/renminpeng/SRR2131201/reference.fasta -I sample1_sorted_add_dedup.bam -O sample1.g.vcf --emit-ref-confidence GVCF</span><br><span class="line"></span><br></pre></td></tr></table></figure>








<p>全基因组重测序SNP_calliiiiiiiiiiiing!!!（内含python脚本）<br>原创 南方 生信小破站 2022-06-10 21:33 广东</p>
<p>处理全基因重测序数据——我在研究生接触到的第一个项目，是我接触到的第二个生信流程，这也是关乎我能否顺利毕业的关键。踩过太多坑，现在记录下整个分析流程，以防以后用到又继续掉坑里。</p>
<p>基因组重测序是对已知基因组序列的物种进行不同个体的基因组测序，并在此基础上对个体或群体进行差异性分析，流程的目的是准确检测出每个样本在基因组中的变异集合，也就是物种之间存在差异的那些序列。</p>
<p>0、流程介绍</p>
<p>✅bwa(MEM alignment)</p>
<p>✅picard(SortSam)</p>
<p>✅picard(AddOrReplaceReadGroups)</p>
<p>✅picard(MarkDuplicates)</p>
<p>✅GATK(HaplotypeCaller)</p>
<p>✅GATK(GenotypeGVCFs)</p>
<p>✅GATK(MergeVcfs）</p>
<p>✅Tassel(run_pipeline.pl)</p>
<p>1、软件安装</p>
<p>BWA——是一种能够将差异度较小的序列比对到一个较大的参考基因组上的软件：conda install bwa；</p>
<p>picard——是一个用来处理高通量测序（HTS）的数据和格式的Java命令行工具箱。Picard是通过使用HTSJDK Java 库 HTSJDK来实现的，支持用来存储高通量测序的数据的常见的文件格式，比如 SAM 和 VCF等。功能方面和Samtools有些重叠，但更多的是互补：conda install picard；</p>
<p>GATK——是Broad Institute开发的用于二代重测序数据分析的一款软件，是基因分析的工具集。在4.0以后，GATK包含有Picard工具集，所有Picard工具都能够使用GATK完成：conda install gatk ；</p>
<p>Tassel——在动植物（尤其是植物）的关联分析中，TASSEL软件是最早出现的开源软件，相对于其他软件，TASSEL也是使用的最广泛的，这里我们用它来做vcf到Hapmap的格式转换：conda install tassel 。</p>
<p>2、原始数据质控</p>
<p>关于质控的教程比较多，通过fastqc和fastp就可以进行质控和数据清洗。在我的转录组流程的时候我也给出了具体的方法，所以不再赘述。</p>
<p>3、流程代码</p>
<pre><code>3.1将参考基因组建立索引
</code></pre>
<p>bwa index -a is  /data/limao/Ref/genome.fasta</p>
<p>为参考基因组的构建索引以便能够在序列比对的时候进行快速的搜索和定位。</p>
<pre><code>3.2比对回参考基因组并转换为bam文件
</code></pre>
<p>bwa mem -M -t 4 -R “@RG\tID:sample1\tSM:sample1\tPL:illumina\tLB:lib1\tPU:unit1”  /data/limao/Ref/genome.fasta sample1_R1.fq.gz sample1_R2.fq.gz | samtools view -bhS -o sample1.bam </p>
<p>参数option：</p>
<p>-t :线程数，我在这里使用4个线程；</p>
<p>-R:设定头文件，必填！接的是 Read Group的字符串信息，这是一个非常重要的信息，以@RG开头，它是用来将比对的read进行分组的。不同的组之间测序过程被认为是相互独立的，在Read Group中，有如下几个信息非常重要：</p>
<p>ID：通道名或样本名,通过这个信息分组，必须唯一；</p>
<p>SM：样本名，同样非常重要；</p>
<p>LB：⽂库名；这个重要性稍微低一些，主要也是为了协助区分不同的group而存在。</p>
<p>PL：测序平台信息[COMPLETE,ILLUMINA,SANGER]。</p>
<p>以上这些信息对于我们后续对比对数据进行错误率分析和markduplicate时非常重要。</p>
<pre><code>3.3 对bam文件排序
</code></pre>
<p>java -jar /data/limao/soft/picard.jar SortSam INPUT=sample1.bam OUTPUT=sample1_sorted.bam SORT_ORDER=coordinate TMP_DIR=./tmp</p>
<p>这一步是将sam文件中同一染色体对应的条目按照坐标顺序从小到大进行排序</p>
<pre><code> 3.4 对bam文件进行加头（head）处理
</code></pre>
<p>java -jar /data/limao/soft/picard.jar AddOrReplaceReadGroups I=sample1_sorted.bam O=sample1_sorted_add.bam RGLB=lib1 RGPL=illumina RGPU=unit1 RGSM=sample1 TMP_DIR=./tmp</p>
<p>GATK2.0以上版本将不再支持无头文件的变异检测。加头这一步可以在BWA比对的时候进行，通过-r参数的选择可以完成。如果在BWA比对期间没有选择-r参数，可以增加这一步骤。</p>
<p>参数option：</p>
<p>RGID：输入reads集ID号；</p>
<p>RGLB：read集文库名；</p>
<p>RGPL：测序平台（illunima或solid）；</p>
<p>RGPU：测序平台下级单位名称（run的名称）；</p>
<p>RGSM：样本名称。</p>
<pre><code> 3.5 去除PCR重复序列
</code></pre>
<p>java -jar /data/limao/soft/picard.jar MarkDuplicates I=sample1_sorted_add.bam O=sample1_sorted_add_dedup.bam M=sample1_sorted_add_dedup.metrics CREATE_INDEX=true MAX_FILE_HANDLES_FOR_READ_ENDS_MAP=4000 TMP_DIR=./tmp</p>
<p>现有的工具包括Samtools和Picard都可以去除重复序列。不同的地方在于，samtools的rmdup是直接将这些重复序列从比对BAM文件中删除掉，而Picard的MarkDuplicates默认情况则只是在BAM的FLAG信息中标记出来，并留存这些序列，以便在你需要的时候还可以对其做分析。</p>
<p>  3.6 变异检测，生成vcf文件（单样品）</p>
<p>gatk3 -nct 4 -T HaplotypeCaller -R /data/limao/Ref/genome.fasta –emitRefConfidence -I sample1 _sorted_add_dedup.bam -o sample1.g.vcf</p>
<p>单样本到这一步就可以生成VCF了，使用HaplotypeCaller对bam文件进行call variant，就是寻找变异的过程，生成一个VCF文件用于后续位点的质控和注释,从一个bam到一个vcf文件。</p>
<pre><code> 3.7 变异检测，生成gvcf文件（多样品）
</code></pre>
<p>gatk3 -nct 4 -T HaplotypeCaller -R /data/limao/Ref/genome.fasta –emitRefConfidence GVCF -I sample1 _sorted_add_dedup.bam -o sample1.g.vcf</p>
<p>随着测序行业的发展，大规模的测序会变得越来越普遍，并且基于群体的数据分析要远优于单样本，意义也更加深远，因此这种多样本的模式将成为常态。gvcf会记录每一个位点到情况，包括有无突变，vcf只记录突变位点情况。</p>
<h3 id="3-6-3-7解释"><a href="#3-6-3-7解释" class="headerlink" title="3.6  3.7解释"></a>3.6  3.7解释</h3><p>您提供的两个命令用于使用GATK（Genome Analysis Toolkit）进行变异检测，生成VCF（Variant Call Format）文件。两个命令都调用了HaplotypeCaller工具，但目的和输出略有不同。</p>
<h3 id="命令对比"><a href="#命令对比" class="headerlink" title="命令对比"></a>命令对比</h3><ol>
<li><p><strong>生成VCF文件（单样本）</strong>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gatk3 -nct 4 -T HaplotypeCaller -R /data/limao/Ref/genome.fasta --emitRefConfidence -I sample1_sorted_add_dedup.bam -o sample1.g.vcf</span><br></pre></td></tr></table></figure>

<p>这个命令用于单个样本的变异检测，生成一个VCF文件。<code>--emitRefConfidence</code>选项应该后面还需要指定具体的参数（如<code>GVCF</code>或者其他），但在这个命令里没有完整指定，可能是个遗漏。这个命令应该生成包含变异位点信息的gVCF文件，但由于参数不完整，实际效果可能与预期不符。</p>
</li>
<li><p><strong>生成gVCF文件（多样本）</strong>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gatk3 -nct 4 -T HaplotypeCaller -R /data/limao/Ref/genome.fasta --emitRefConfidence GVCF -I sample1_sorted_add_dedup.bam -o sample1.g.vcf</span><br></pre></td></tr></table></figure>

<p>这个命令用于单个样本的变异检测，但输出是gVCF文件。gVCF（Genomic VCF）是VCF的一种扩展格式，它不仅包含变异位点的信息，还包含了参考基因组上所有位置的信息，无论这些位置是否存在变异。这使得gVCF特别适合于多样本的分析，因为它允许后续的合并分析和变异的再调用，以提高变异检测的准确性和效率。</p>
</li>
</ol>
<h3 id="主要区别"><a href="#主要区别" class="headerlink" title="主要区别"></a>主要区别</h3><ul>
<li><p><strong>VCF vs. gVCF</strong>: VCF文件仅记录变异位点的信息，而gVCF文件记录了基因组上每一个位置的信息，包括没有变异的位置。这使得gVCF格式非常适合多样本分析和大规模基因组项目，因为它提供了更全面的基因组覆盖信息。</p>
</li>
<li><p><strong>单样本 vs. 多样本分析</strong>: 第一个命令（假设正确指定了参数）和第二个命令都可以用于单样本的变异检测。然而，gVCF格式的引入是为了更有效地支持多样本分析，因为它允许后续步骤整合多个样本的数据，以便于发现更多的遗传变异和进行群体遗传学分析。</p>
</li>
</ul>
<h3 id="代码问题"><a href="#代码问题" class="headerlink" title="代码问题"></a>代码问题</h3><ul>
<li>第一个命令中的<code>--emitRefConfidence</code>后应该跟随<code>GVCF</code>参数，以正确生成gVCF文件。</li>
<li>文件名<code>sample1 _sorted_add_dedup.bam</code>中似乎有一个多余的空格，应该是<code>sample1_sorted_add_dedup.bam</code>。</li>
</ul>
<p>修正后的第一个命令如下（如果目的是生成gVCF文件）:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gatk3 -nct 4 -T HaplotypeCaller -R /data/limao/Ref/genome.fasta --emitRefConfidence GVCF -I sample1_sorted_add_dedup.bam -o sample1.g.vcf</span><br></pre></td></tr></table></figure>

<p>这样，两个命令实际上是相同的，都是用于生成单样本的gVCF文件。</p>
<p>java -jar /home/data1/renminpeng/SRR2131201/gatk-4.1.8.1/gatk-package-4.1.8.1-local.jar -nct 24 -T HaplotypeCaller -R /home/data1/renminpeng/SRR2131201/reference.fasta –emitRefConfidence -I sample1 _sorted_add_dedup.bam -o sample1.g.vcf</p>
<p>这个命令生成的是包含所有的吗？</p>
<p>如果您想分别生成SNPs和InDels的VCF文件，您可以先使用GATK HaplotypeCaller生成包含所有变异类型的VCF文件，然后使用GATK的SelectVariants工具来分别提取SNPs和InDels。这个过程分为两步：</p>
<h3 id="1-使用HaplotypeCaller生成VCF"><a href="#1-使用HaplotypeCaller生成VCF" class="headerlink" title="1. 使用HaplotypeCaller生成VCF"></a>1. 使用HaplotypeCaller生成VCF</h3><p>首先，使用HaplotypeCaller生成包含所有变异（SNPs和InDels）的VCF文件，如之前所述：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gatk HaplotypeCaller \</span><br><span class="line">   -R /path/to/reference/genome.fasta \</span><br><span class="line">   -I /path/to/sample_sorted_dedup.bam \</span><br><span class="line">   -O /path/to/output_variants.vcf.gz</span><br></pre></td></tr></table></figure>

<h3 id="2-使用SelectVariants分别提取SNPs和InDels"><a href="#2-使用SelectVariants分别提取SNPs和InDels" class="headerlink" title="2. 使用SelectVariants分别提取SNPs和InDels"></a>2. 使用SelectVariants分别提取SNPs和InDels</h3><p>接下来，使用SelectVariants工具从步骤1生成的VCF文件中分别提取SNPs和InDels。</p>
<h4 id="提取SNPs："><a href="#提取SNPs：" class="headerlink" title="提取SNPs："></a>提取SNPs：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">gatk SelectVariants \</span><br><span class="line">   -R /path/to/reference/genome.fasta \</span><br><span class="line">   -V /path/to/output_variants.vcf.gz \</span><br><span class="line">   --select-type-to-include SNP \</span><br><span class="line">   -O /path/to/output_snps.vcf.gz</span><br></pre></td></tr></table></figure>

<h4 id="提取InDels："><a href="#提取InDels：" class="headerlink" title="提取InDels："></a>提取InDels：</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">gatk SelectVariants \</span><br><span class="line">   -R /path/to/reference/genome.fasta \</span><br><span class="line">   -V /path/to/output_variants.vcf.gz \</span><br><span class="line">   --select-type-to-include INDEL \</span><br><span class="line">   -O /path/to/output_indels.vcf.gz</span><br></pre></td></tr></table></figure>

<p>这样，您将得到两个分开的文件：<code>output_snps.vcf.gz</code>包含所有的SNPs，而<code>output_indels.vcf.gz</code>包含所有的InDels。</p>
<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><ul>
<li>确保替换命令中的路径和文件名以反映您的实际文件和目录结构。</li>
<li>这里使用的命令假设您正在使用GATK 4或更高版本。如果您使用的是GATK 3，命令参数可能需要相应的调整。</li>
<li>如果您对输出的VCF文件有特定的格式要求（比如是否需要压缩），可以根据需要调整输出命令。</li>
</ul>
<h2 id="检测一下是否为gvcf"><a href="#检测一下是否为gvcf" class="headerlink" title="检测一下是否为gvcf"></a>检测一下是否为gvcf</h2><p>是的，您可以从生成的gVCF文件中分离出SNPs（单核苷酸多态性）和InDels（插入和删除），并生成分别只包含这些变异类型的标准VCF文件。这可以通过使用GATK的<code>SelectVariants</code>工具来完成。以下是如何进行操作的步骤：</p>
<h3 id="分离SNPs："><a href="#分离SNPs：" class="headerlink" title="分离SNPs："></a>分离SNPs：</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">gatk SelectVariants \</span><br><span class="line">   -R /path/to/reference/genome.fasta \</span><br><span class="line">   -V /path/to/sample1.g.vcf \</span><br><span class="line">   --select-type-to-include SNP \</span><br><span class="line">   -O /path/to/sample1_snps.vcf</span><br></pre></td></tr></table></figure>

<p>这个命令会从您的gVCF文件中选择SNPs，并将结果保存到一个新的VCF文件中。</p>
<h3 id="分离InDels："><a href="#分离InDels：" class="headerlink" title="分离InDels："></a>分离InDels：</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">gatk SelectVariants \</span><br><span class="line">   -R /path/to/reference/genome.fasta \</span><br><span class="line">   -V /path/to/sample1.g.vcf \</span><br><span class="line">   --select-type-to-include INDEL \</span><br><span class="line">   -O /path/to/sample1_indels.vcf</span><br></pre></td></tr></table></figure>

<p>这个命令会从gVCF文件中选择InDels，并将结果保存到另一个新的VCF文件中。</p>
<h3 id="注意："><a href="#注意：" class="headerlink" title="注意："></a>注意：</h3><ul>
<li>确保替换命令中的路径和文件名以反映您的实际文件和目录结构。</li>
<li>这些步骤假设您已经使用GATK HaplotypeCaller生成了一个gVCF文件，且该文件包含了全基因组的变异信息以及非变异位点的置信度信息。</li>
</ul>
<p>通过以上步骤，您可以根据变异类型（SNPs或InDels）将变异信息分离到不同的VCF文件中，这对于后续的特定分析或者数据的进一步处理可能是非常有用的。这种方法允许研究者对数据进行更细致的分析，例如，针对不同类型的变异进行特定的遗传学分析或者关联研究。</p>
<p>多样品处理</p>
<p>我手上的基因组重测序数据就有400多个样品，让人一个一个跑还是很繁琐的。所以写个脚本批量处理是非常有必要的。</p>
<p>4.1 gvcf文件脚本代码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#!/usr/local/bin/python3  </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-  </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># This script file shoud be at the same directory with Cleandata</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2022.02.09</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># delete redundancy  bamFile</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># python3  $0 -t 9 -i input_dir -r ReferenceFile</span></span><br><span class="line"></span><br><span class="line">import os, sys, glob, time, argparse,threading</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">my_parser = argparse.ArgumentParser()</span><br><span class="line"></span><br><span class="line">my_parser.add_argument(<span class="string">&#x27;-t&#x27;</span>, dest=<span class="string">&#x27;thread&#x27;</span>,<span class="built_in">type</span>=int,default=<span class="string">&#x27;4&#x27;</span>) <span class="comment">#线程数</span></span><br><span class="line"></span><br><span class="line">my_parser.add_argument(<span class="string">&#x27;-i&#x27;</span>, dest=<span class="string">&#x27;input_dir&#x27;</span>) <span class="comment">#线程数</span></span><br><span class="line"></span><br><span class="line">my_parser.add_argument(<span class="string">&#x27;-r&#x27;</span>, dest=<span class="string">&#x27;reference&#x27;</span>) <span class="comment">#线程数</span></span><br><span class="line"></span><br><span class="line">args = my_parser.parse_args()</span><br><span class="line"></span><br><span class="line">TimeTable = open(args.input_dir+<span class="string">&#x27;TimeTable.txt&#x27;</span>,<span class="string">&#x27;w&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ref=args.reference</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">output_bam_dir = args.input_dir + <span class="string">&#x27;_bam_dir&#x27;</span></span><br><span class="line"></span><br><span class="line">output_gvcf_dir = args.input_dir + <span class="string">&#x27;_gvcf_dir&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> os.path.exists(output_bam_dir):</span><br><span class="line"></span><br><span class="line">    sys.exit(output_bam_dir+<span class="string">&#x27; exist!!!&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">elif</span> os.path.exists(output_gvcf_dir):</span><br><span class="line"></span><br><span class="line">    sys.exit(output_gvcf_dir+<span class="string">&#x27; exist!!!&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line"></span><br><span class="line">    os.makedirs(output_bam_dir)</span><br><span class="line"></span><br><span class="line">    os.makedirs(output_gvcf_dir)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def mult(funct, <span class="built_in">ls</span>, n=3):</span><br><span class="line"></span><br><span class="line">    pool = []  <span class="comment"># 线程池</span></span><br><span class="line"></span><br><span class="line">    length = len(<span class="built_in">ls</span>)</span><br><span class="line"></span><br><span class="line">    step = int(length / n) + 1</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(0, length, step):</span><br><span class="line"></span><br><span class="line">        p = threading.Thread(target=funct, args=(<span class="built_in">ls</span>[i: i + step],)) <span class="comment">#把ls切成了n段，每段step长，最后段可能断一点</span></span><br><span class="line"></span><br><span class="line">        pool.append(p)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> pool: <span class="comment">#pool包含列表的列表，长度为n（即n个列表），每一个列表长度为step。</span></span><br><span class="line"></span><br><span class="line">        p.start() <span class="comment">#这里同时启动n个进程，一个进程里加入参数ls[i: i + step]，funct函数会对ls[i: i + step]慢慢处理。</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> pool:</span><br><span class="line"></span><br><span class="line">        p.join() <span class="comment">#等待所有进程结束</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(time.strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>,time.localtime(time.time()))+<span class="string">&#x27;_Main thread STAR exiting&#x27;</span>, file=TimeTable)</span><br><span class="line"></span><br><span class="line">    TimeTable.flush()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sample_names_dir = glob.glob(args.input_dir+<span class="string">&#x27;/*&#x27;</span>) <span class="comment"># Every sample has a directory which contain fq.gz file 每个样品单独一个文件夹，文件夹下包含fq.gz的文件 不包含绝对路径</span></span><br><span class="line"></span><br><span class="line">bam_list = []</span><br><span class="line"></span><br><span class="line">all_sample_fq = &#123;&#125; <span class="comment"># This dictionary will include the sample&#x27;s name (key) and fq.gz (value) 字典以样品名为键，以1或2.fq.gz文件名为值</span></span><br><span class="line"></span><br><span class="line">def bwa(part_sample_directory): <span class="comment">#把bwa封装</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> sample_dir <span class="keyword">in</span> part_sample_directory:</span><br><span class="line"></span><br><span class="line">        sample_head = os.path.basename(sample_dir)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> not (os.path.exists(sample_dir+<span class="string">&#x27;/&#x27;</span>+sample_head+<span class="string">&#x27;_R1.fq.gz&#x27;</span>) and os.path.exists(sample_dir+<span class="string">&#x27;/&#x27;</span>+sample_head+<span class="string">&#x27;_R1.fq.gz&#x27;</span>)):</span><br><span class="line"></span><br><span class="line">            sys.exit(sample_dir+<span class="string">&#x27;/&#x27;</span>+sample_head+<span class="string">&#x27;_R1.fq.gz&#x27;</span> + <span class="string">&#x27; or &#x27;</span>+sample_dir+<span class="string">&#x27;/&#x27;</span>+sample_head+<span class="string">&#x27;_R1.fq.gz&#x27;</span> + <span class="string">&quot; don&#x27;t exist!!!&quot;</span>)</span><br><span class="line"></span><br><span class="line">        os.system(<span class="string">&#x27;bwa mem -M -t 4 -R  &quot;@RG\\tID:&#123;0&#125;\\tSM:&#123;0&#125;\\tPL:illumina\\tLB:lib1\\tPU:unit1&quot; &#123;1&#125; &#123;2&#125;/&#123;0&#125;_R1.fq.gz &#123;2&#125;/&#123;0&#125;_R2.fq.gz | samtools view -bhS -o &#123;3&#125;/&#123;0&#125;.bam&#x27;</span>.format(sample_head, ref, sample_dir, output_bam_dir))</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(time.strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>,time.localtime(time.time()))+<span class="string">&#x27;bwa programming finished***In threading***&#x27;</span>+sample_head, file=TimeTable)</span><br><span class="line"></span><br><span class="line">        TimeTable.flush()</span><br><span class="line"></span><br><span class="line">        time.sleep(0.2)</span><br><span class="line"></span><br><span class="line">        os.system(<span class="string">&#x27;picard SortSam INPUT=&#123;0&#125;/&#123;1&#125;.bam OUTPUT=&#123;0&#125;/&#123;1&#125;_sorted.bam SORT_ORDER=coordinate TMP_DIR=./tmp&#x27;</span>.format(output_bam_dir,sample_head))</span><br><span class="line"></span><br><span class="line">        time.sleep(0.2)</span><br><span class="line"></span><br><span class="line">        os.system(<span class="string">&#x27;rm &#123;0&#125;/&#123;1&#125;.bam&#x27;</span>.format(output_bam_dir,sample_head))</span><br><span class="line"></span><br><span class="line">        os.system(<span class="string">&#x27;picard AddOrReplaceReadGroups I=&#123;0&#125;/&#123;1&#125;_sorted.bam O=&#123;0&#125;/&#123;1&#125;_sorted_add.bam RGLB=lib1 RGPL=illumina RGPU=unit1 RGSM=&#123;1&#125; TMP_DIR=./tmp&#x27;</span>.format(output_bam_dir,sample_head))</span><br><span class="line"></span><br><span class="line">        time.sleep(0.2)</span><br><span class="line"></span><br><span class="line">        os.system(<span class="string">&#x27;rm &#123;0&#125;/&#123;1&#125;_sorted.bam&#x27;</span>.format(output_bam_dir,sample_head))</span><br><span class="line"></span><br><span class="line">        os.system(<span class="string">&#x27;picard MarkDuplicates I=&#123;0&#125;/&#123;1&#125;_sorted_add.bam O=&#123;0&#125;/&#123;1&#125;_sorted_add_dedup.bam M=&#123;0&#125;/&#123;1&#125;_sorted_add_dedup.metrics CREATE_INDEX=true MAX_FILE_HANDLES_FOR_READ_ENDS_MAP=4000 TMP_DIR=./tmp&#x27;</span>.format(output_bam_dir,sample_head))</span><br><span class="line"></span><br><span class="line">        time.sleep(0.2)</span><br><span class="line"></span><br><span class="line">        os.system(<span class="string">&#x27;rm &#123;0&#125;/&#123;1&#125;_sorted_add.bam&#x27;</span>.format(output_bam_dir,sample_head))</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(time.strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>,time.localtime(time.time()))+<span class="string">&#x27;picard BuildBamIndex programming finished***In threading***&#x27;</span>+sample_head, file=TimeTable)</span><br><span class="line"></span><br><span class="line">        os.system(<span class="string">&quot;gatk3 -nct 4 -T HaplotypeCaller -R &#123;0&#125; --emitRefConfidence GVCF -I &#123;1&#125;/&#123;2&#125;_sorted_add_dedup.bam -o &#123;3&#125;/&#123;2&#125;.g.vcf&quot;</span>.format(ref, output_bam_dir,sample_head,output_gvcf_dir))</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(time.strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>,time.localtime(time.time()))+<span class="string">&#x27;gatk3 programming finished***In threading***&#x27;</span>+sample_head, file=TimeTable)</span><br><span class="line"></span><br><span class="line">        TimeTable.flush()</span><br><span class="line"></span><br><span class="line">        bam_list.append(<span class="string">&#x27;--variant  &#123;0&#125;/&#123;1&#125;.g.vcf&#x27;</span>.format(output_gvcf_dir,sample_head))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">https://mp.weixin.qq.com/s/NKJsdywpHkhtkr4H25iNHg</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">当然，我将在代码中加入注释，以便更好地理解每个部分的功能和目的：</span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line"><span class="comment">#!/usr/local/bin/python3  </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-  </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 这个脚本用于处理高通量测序数据，包括序列比对、排序、去重复和变异检测</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设定脚本和Cleandata目录在同一目录下</span></span><br><span class="line"><span class="comment"># 2022.02.09 - 脚本版本日期</span></span><br><span class="line"><span class="comment"># 删除冗余的bam文件</span></span><br><span class="line"></span><br><span class="line">import os, sys, glob, time, argparse, threading</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置命令行参数</span></span><br><span class="line">my_parser = argparse.ArgumentParser()</span><br><span class="line">my_parser.add_argument(<span class="string">&#x27;-t&#x27;</span>, dest=<span class="string">&#x27;thread&#x27;</span>, <span class="built_in">type</span>=int, default=<span class="string">&#x27;4&#x27;</span>) <span class="comment"># 线程数，默认为4</span></span><br><span class="line">my_parser.add_argument(<span class="string">&#x27;-i&#x27;</span>, dest=<span class="string">&#x27;input_dir&#x27;</span>) <span class="comment"># 输入目录</span></span><br><span class="line">my_parser.add_argument(<span class="string">&#x27;-r&#x27;</span>, dest=<span class="string">&#x27;reference&#x27;</span>) <span class="comment"># 参考基因组文件</span></span><br><span class="line">args = my_parser.parse_args()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建记录时间的文件</span></span><br><span class="line">TimeTable = open(args.input_dir + <span class="string">&#x27;TimeTable.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取参考基因组文件路径</span></span><br><span class="line">ref = args.reference</span><br><span class="line"></span><br><span class="line"><span class="comment"># 准备输出目录路径</span></span><br><span class="line">output_bam_dir = args.input_dir + <span class="string">&#x27;_bam_dir&#x27;</span></span><br><span class="line">output_gvcf_dir = args.input_dir + <span class="string">&#x27;_gvcf_dir&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查输出目录是否存在，如果存在则退出</span></span><br><span class="line"><span class="keyword">if</span> os.path.exists(output_bam_dir):</span><br><span class="line">    sys.exit(output_bam_dir + <span class="string">&#x27; exist!!!&#x27;</span>)</span><br><span class="line"><span class="keyword">elif</span> os.path.exists(output_gvcf_dir):</span><br><span class="line">    sys.exit(output_gvcf_dir + <span class="string">&#x27; exist!!!&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    os.makedirs(output_bam_dir)</span><br><span class="line">    os.makedirs(output_gvcf_dir)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义一个函数来并行处理数据</span></span><br><span class="line">def mult(funct, <span class="built_in">ls</span>, n=3):</span><br><span class="line">    pool = []  <span class="comment"># 线程池</span></span><br><span class="line">    length = len(<span class="built_in">ls</span>)</span><br><span class="line">    step = int(length / n) + 1</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(0, length, step):</span><br><span class="line">        p = threading.Thread(target=funct, args=(<span class="built_in">ls</span>[i: i + step],))</span><br><span class="line">        pool.append(p)</span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> pool:</span><br><span class="line">        p.start()</span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> pool:</span><br><span class="line">        p.join()</span><br><span class="line">    <span class="built_in">print</span>(time.strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>, time.localtime(time.time())) + <span class="string">&#x27;_Main thread STAR exiting&#x27;</span>, file=TimeTable)</span><br><span class="line">    TimeTable.flush()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取样本名目录</span></span><br><span class="line">sample_names_dir = glob.glob(args.input_dir + <span class="string">&#x27;/*&#x27;</span>) </span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化一个字典来存储样本名和对应的fq.gz文件</span></span><br><span class="line">all_sample_fq = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义bwa序列比对的函数</span></span><br><span class="line">def bwa(part_sample_directory):</span><br><span class="line">    <span class="keyword">for</span> sample_dir <span class="keyword">in</span> part_sample_directory:</span><br><span class="line">        sample_head = os.path.basename(sample_dir)</span><br><span class="line">        <span class="keyword">if</span> not (os.path.exists(sample_dir + <span class="string">&#x27;/&#x27;</span> + sample_head + <span class="string">&#x27;_R1.fq.gz&#x27;</span>) and os.path.exists(sample_dir + <span class="string">&#x27;/&#x27;</span> + sample_head + <span class="string">&#x27;_R1.fq.gz&#x27;</span>)):</span><br><span class="line">            sys.exit(sample_dir + <span class="string">&#x27;/&#x27;</span> + sample_head + <span class="string">&#x27;_R1.fq.gz&#x27;</span> + <span class="string">&#x27; or &#x27;</span> + sample_dir + <span class="string">&#x27;/&#x27;</span> + sample_head + <span class="string">&#x27;_R1.fq.gz&#x27;</span> + <span class="string">&quot; don&#x27;t exist!!!&quot;</span>)</span><br><span class="line">        <span class="comment"># 执行BWA序列比对命令</span></span><br><span class="line">        os.system(<span class="string">&#x27;bwa mem -M -t 4 -R &quot;@RG\\tID:&#123;0&#125;\\tSM:&#123;0&#125;\\tPL:illumina\\tLB:lib1\\tPU:unit1&quot; &#123;1&#125; &#123;2&#125;/&#123;0&#125;_R1.fq.gz &#123;2&#125;/&#123;0&#125;_R2.fq.gz | samtools view -bhS -o &#123;3&#125;/&#123;0&#125;.bam&#x27;</span>.format(sample_head, ref, sample_dir, output_bam_dir))</span><br><span class="line">        <span class="built_in">print</span>(time.strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>, time.localtime(time.time())) + <span class="string">&#x27;bwa programming finished***In threading***&#x27;</span> + sample_head, file=TimeTable)</span><br><span class="line">        TimeTable.flush()</span><br><span class="line">        <span class="comment"># 接下来的命令用于处理BAM文件，包括排序、去重复等</span></span><br><span class="line">        <span class="comment"># 注意：以下操作需要Picard和GATK工具已经安装并配置好环境变量</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意：脚本中的bwa函数只是被定义了，但实际上并没有在脚本中被调用执行。</span></span><br><span class="line"><span class="comment"># 你需要根据实际情况添加相应的调用代码，例如：mult(bwa, sample_names_dir, args.thread)</span></span><br><span class="line">```</span><br><span class="line"></span><br><span class="line">这个脚本的注释主要是为了帮助理解每</span><br><span class="line"></span><br><span class="line">个部分的作用，包括设置命令行参数、创建和检查输出目录、多线程处理、样本目录获取和处理以及核心的BWA序列比对流程。希望这些注释能让你更好地理解和使用这个脚本。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>脚本名：institute2_DNA_to_VCF1.4.py</p>
<p>由于内存原因，跑太多样品会导致出错停止运行，所以我分40个样品一组运行脚本，流程仅到gvf这一步，等400多个样品全部gvf后再进行整合。</p>
<pre><code> 4.1.1 运行脚本
</code></pre>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">nohup</span> python3 institute2_DNA_to_VCF1.4.py -t 4 -i cleandata/ -r /data/limao/Ref/genome.fasta &amp;</span><br></pre></td></tr></table></figure>
<p>参数option：</p>
<p>-t：线程数，我在这里使用4个线程；</p>
<p>-i：包含质控后的测序数据文件夹。格式如下：</p>
<img src="/2024/03/02/%E5%85%A8%E5%9F%BA%E5%9B%A0%E7%BB%84%E9%87%8D%E6%B5%8B%E5%BA%8F/1.png" class="" width="1">


<p>-r：参考基因组。</p>
<p>运行结束，得到gvcf文件。结果如下：</p>
<img src="/2024/03/02/%E5%85%A8%E5%9F%BA%E5%9B%A0%E7%BB%84%E9%87%8D%E6%B5%8B%E5%BA%8F/2.png" class="" width="2">


<h2 id="4-2-多gvcf整合并转换为vcf文件脚本代码"><a href="#4-2-多gvcf整合并转换为vcf文件脚本代码" class="headerlink" title="4.2 多gvcf整合并转换为vcf文件脚本代码"></a>4.2 多gvcf整合并转换为vcf文件脚本代码</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># python3 $0 -i g.vcf.dir -r ref</span></span><br><span class="line"></span><br><span class="line">import os, sys, glob, time, argparse,threading,re</span><br><span class="line"></span><br><span class="line">my_parser = argparse.ArgumentParser()</span><br><span class="line"></span><br><span class="line">my_parser = argparse.ArgumentParser()</span><br><span class="line"></span><br><span class="line">my_parser.add_argument(<span class="string">&#x27;-i&#x27;</span>, dest=<span class="string">&#x27;input_dir&#x27;</span>) <span class="comment">#</span></span><br><span class="line"></span><br><span class="line">my_parser.add_argument(<span class="string">&#x27;-r&#x27;</span>, dest=<span class="string">&#x27;reference&#x27;</span>) <span class="comment">#</span></span><br><span class="line"></span><br><span class="line">args = my_parser.parse_args()</span><br><span class="line"></span><br><span class="line">ref=args.reference</span><br><span class="line"></span><br><span class="line">sample_names_dir = glob.glob(args.input_dir+<span class="string">&#x27;/*.g.vcf&#x27;</span>)</span><br><span class="line"></span><br><span class="line">gvcf_list=[]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> gvcf_input <span class="keyword">in</span> sample_names_dir:</span><br><span class="line"></span><br><span class="line">        gvcf_list.append(<span class="string">&#x27;--variant  &#x27;</span>+gvcf_input)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;java -Djava.io.tmpdir=./tmp -jar /data/jzhao/soft/GenomeAnalysisTK.jar -nt 4 -T GenotypeGVCFs -R &#123;0&#125; -o All.vcf &#123;1&#125;&quot;</span>.format(ref, <span class="string">&#x27; &#x27;</span>.<span class="built_in">join</span>(gvcf_list)))</span><br></pre></td></tr></table></figure>


<h2 id="4-2-1-运行代码"><a href="#4-2-1-运行代码" class="headerlink" title="4.2.1 运行代码"></a>4.2.1 运行代码</h2><p>python3 g.vcf_to.vcf.sh -i Cleandata_gvcf_dir -r /data/limao/Ref/genome.fasta </p>
<p>脚本名：g.vcf_to.vcf.sh</p>
<p>参数option：</p>
<p>-i：包含全部数据样品的gvcf文件；</p>
<p>-r：参考基因组。</p>
<h2 id="4-2-2-脚本格式已经满足"><a href="#4-2-2-脚本格式已经满足" class="headerlink" title="4.2.2 脚本格式已经满足"></a>4.2.2 脚本格式已经满足</h2><p>java -Djava.io.tmpdir=./tmp -jar /data/limao/soft/GenomeAnalysisTK.jar -nt 4 -T GenotypeGVCFs -R /data/jzhao/Ref/genome.fasta  -o All.vcf –variant  Cleandata_gvcf_dir/B903.g.vcf –variant  Cleandata_gvcf_dir/B904.g.vcf –variant  Cleandata_gvcf_dir/B908.g.vcf –variant  Cleandata_gvcf_dir/B937.g.vcf –variant  Cleandata_gvcf_dir/B941.g.vcf –variant  Cleandata_gvcf_dir/B963.g.vcf –variant  Cleandata_gvcf_dir/P1001.g.vcf –variant  Cleandata_gvcf_dir/P1008.g.vcf –variant  Cleandata_gvcf_dir/P1031.g.vcf</p>
<p>运行以上代码后得到All.vcf</p>
<h2 id="4-3-SnpEff注释数据库对All-vcf注释"><a href="#4-3-SnpEff注释数据库对All-vcf注释" class="headerlink" title="4.3 SnpEff注释数据库对All.vcf注释"></a>4.3 SnpEff注释数据库对All.vcf注释</h2><p>java -Xmx4g -jar /data/limao/soft/snpEff/snpEff.jar genome All.vcf &gt; All.eff.vcf</p>
<p>All.eff.vcf是一个注释结果文件，其就在vcf的info信息新添加了anno一列信息，其具体每个值含义如下：</p>
<p>Allele：突变之后的碱基，第一个突变位点由T碱基突变成了C碱基，对应Allel的值为C。<br>Annotation：由sequence ontology定义的突变类型<br>Annotation_Impact：对变异位点有害程度的简单评估，取值有HIGH, MODERATE, LOW, MODIFIER 4种，含义如下:</p>
<p>  4.2.2 变异质控（硬过滤）</p>
<p>过滤的时候，需要分SNP和Indel这两个不同的变异类型来进行，它们有些阈值是不同的，需要区别对待</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用SelectVariants，选出SNP</span></span><br><span class="line"></span><br><span class="line">gatk3 -T SelectVariants -R /data/limao/Ref/genome.fasta -V All.eff.vcf -selectType SNP -o All.snps.vcf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 为SNP作硬过滤</span></span><br><span class="line"></span><br><span class="line">gatk3 -T VariantFiltration -R /data/limao/Ref/genome.fasta -V All.snps.vcf --filterExpression <span class="string">&quot;QD &lt; 2.0 || FS &gt; 60.0 || MQ &lt; 40.0 || MQRankSum &lt; -12.5 || ReadPosRankSum &lt; -8.0&quot;</span> --filterName <span class="string">&quot;my_All_snp_filter&quot;</span> -o All.filtered_snps.vcf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用SelectVariants，选出Indel</span></span><br><span class="line"></span><br><span class="line">gatk3 -T SelectVariants -R /data/limao/Ref/genome.fasta  -V All.eff.vcf -selectType INDEL -o All.indels.vcf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 为Indel作硬过滤</span></span><br><span class="line"></span><br><span class="line">gatk3 -T VariantFiltration -R /data/limao/Ref/genome.fasta  -V All.indels.vcf --filterExpression <span class="string">&quot;QD &lt; 2.0 || FS &gt; 200.0 || ReadPosRankSum &lt; -20.0&quot;</span> --filterName <span class="string">&quot;my_All_indel_filter&quot;</span> -o All.filtered_indels.vcf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#重新合并过滤后的SNP和Indel</span></span><br><span class="line"></span><br><span class="line">gatk MergeVcfs -I All.filtered_snps.vcf -I All.filtered_indels.vcf -O All.filtered.vcf</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>GATK4官网给出的推荐阈值：</p>
<p>For snps:</p>
<blockquote>
<p>QD &lt; 2.0<br>MQ &lt; 40.0<br>FS &gt; 60.0<br>SOR &gt; 3.0<br>MQRankSum &lt; -12.5<br>ReadPosRankSum &lt; -8.0</p>
</blockquote>
<p>For indels:</p>
<blockquote>
<p>QD &lt; 2.0<br>ReadPosRankSum &lt; -20.0<br>InbreedingCoeff &lt; -0.8<br>FS &gt; 200.0<br>SOR &gt; 10.0</p>
</blockquote>
<p>5.个性化分析</p>
<p>5.1 vcftools提取一段区域的vcf文件</p>
<p>vcftools –vcf All.filtered.vcf –chr Chrxx –from-bp 252463xx –to-bp 252493xx –out Chrxx.promoter –recode –recode-INFO-all</p>
<p>截取某个基因的启动子或编码区区域进行单倍型分析。</p>
<pre><code> 5.2 数据格式转换（VCF到Hapmap）
</code></pre>
<p>perl run_pipeline.pl -Xms4G  -fork1 -vcf Chrxx.promoter  -export Chrxx.promoter.txt -exportType Hapmap</p>
<p>在这里，整篇文章就结束了。说点心里话，接触生信一年多，我记得刚入门的时候有位老师就告诉我：“生信的主要目的就是解决生物问题”。其实生信流程并非只是硬邦邦地告诉大家几条简单的命令就了事。如果都觉得只要懂得几条命令就可以了的话，那么我们就活该被机器和人工智能所取替，它们一定会操作得更好更高效。我想掌握工具和技术的目的是为了能够更好地发现并解决问题（包括科研和生产），所有的数据分析流程本质上是要服务于我们所要解决的问题的。</p>
<p>毕竟工具是死的，人是活的，需求总是会变的。理解我们所要处理的问题的本质，选择合适的工具，而不是反过来被工具所束缚，这一点很重要。我们的个人能力不能只是会跑一个流程，或者只是会创建流程，因为那都是一个“术”的问题，我觉得我们真正要去掌握的应该是如何分析数据的能力，如何发现问题和解决数据问题等的能力。</p>
<p>上面教程出自   生信小破站 </p>
<p>java -jar /home/data1/renminpeng/SRR2131201/gatk-4.1.8.1/gatk-package-4.1.8.1-local.jar -nct 24 -T HaplotypeCaller -R /home/data1/renminpeng/SRR2131201/reference.fasta –emitRefConfidence -I sample1 _sorted_add_dedup.bam -o sample1.g.vcf</p>
<p>上面的文件是这样生成的？但是</p>
<p>java -jar /home/data1/renminpeng/SRR2131201/gatk-package-4.1.8.1-local.jar SelectVariants -R /home/data1/renminpeng/SRR2131201/reference.fasta -V /home/data1/renminpeng/SRR2131201/sample1.g.vcf –select-type-to-include SNP -O /home/data1/renminpeng/SRR2131201/sample1_snps.vcf</p>
<p>java -jar /home/data1/renminpeng/SRR2131201/gatk-package-4.1.8.1-local.jar SelectVariants -R /home/data1/renminpeng/SRR2131201/reference.fasta -V /home/data1/renminpeng/SRR2131201/sample1.g.vcf –select-type-to-include INDEL -O /home/data1/renminpeng/SRR2131201/sample1_indels.vcf 有没有生成有用的东西，应该是怎么回事？</p>
<p>从您提供的信息来看，您首先使用GATK的HaplotypeCaller工具生成了一个gVCF文件，然后尝试使用SelectVariants工具从该gVCF文件中分别提取SNPs和InDels。您的目的是生成两个文件：一个仅包含SNPs的VCF文件和另一个仅包含InDels的VCF文件。然而，根据您的描述，似乎在执行SelectVariants命令时遇到了问题。</p>
<h3 id="分析可能的问题："><a href="#分析可能的问题：" class="headerlink" title="分析可能的问题："></a>分析可能的问题：</h3><ol>
<li><p><strong>输出文件命名冲突</strong>：在提取SNPs和InDels的命令中，您为输出文件使用了相同的文件名<code>sample1_snps.vcf</code>。这意味着第二个命令（提取InDels的命令）实际上会覆盖第一个命令的输出结果，因此您最终只会得到InDels的数据，而SNPs的数据会丢失。</p>
<p>解决方法是为每种变异类型使用不同的输出文件名，例如：</p>
<ul>
<li>对于SNPs：<code>sample1_snps.vcf</code></li>
<li>对于InDels：<code>sample1_indels.vcf</code></li>
</ul>
</li>
<li><p><strong>检查gVCF文件内容</strong>：如果执行SelectVariants命令后，输出的VCF文件似乎为空或不包含预期的变异信息，可能是因为原始的gVCF文件中没有足够的或任何对应类型的变异数据。这可能是由于样本中确实没有足够的这类变异，或者变异检测过程中的参数设置影响了变异的识别。</p>
</li>
<li><p><strong>命令格式和参数</strong>：确保使用的命令格式和参数正确无误。例如，GATK的某些版本可能不支持<code>-nct</code>参数（用于指定线程数），因为GATK 4及以上版本使用了不同的并行化策略。请确保您按照GATK 4的要求正确使用命令和参数。</p>
</li>
</ol>
<h3 id="推荐的步骤："><a href="#推荐的步骤：" class="headerlink" title="推荐的步骤："></a>推荐的步骤：</h3><ul>
<li><p><strong>更正输出文件名</strong>：确保为不同类型的变异分别指定不同的输出文件名。</p>
</li>
<li><p><strong>验证gVCF内容</strong>：使用<code>grep</code>或其他工具查看原始gVCF文件中是否确实包含了SNPs和InDels。您可以查找特定的变异类型标记，如<code>SNP</code>或<code>INDEL</code>，来确认它们是否存在。</p>
</li>
<li><p><strong>查看日志和错误信息</strong>：执行命令时，GATK通常会输出日志和错误信息。检查这些信息可能会提供为什么变异没有被成功提取的线索。</p>
</li>
</ul>
<p>如果在执行这些步骤后仍然无法成功提取所需的变异信息，可能需要进一步检查GATK的文档，确保所有步骤都符合GATK的最新使用指南和最佳实践。</p>
<h2 id="嗯，名字的时候我改了，验证gVCF内容：使用grep或其他工具查看原始gVCF文件中是否确实包含了SNPs和InDels。您可以查找特定的变异类型标记，如SNP或INDEL，来确认它们是否存在。？怎么做？"><a href="#嗯，名字的时候我改了，验证gVCF内容：使用grep或其他工具查看原始gVCF文件中是否确实包含了SNPs和InDels。您可以查找特定的变异类型标记，如SNP或INDEL，来确认它们是否存在。？怎么做？" class="headerlink" title="嗯，名字的时候我改了，验证gVCF内容：使用grep或其他工具查看原始gVCF文件中是否确实包含了SNPs和InDels。您可以查找特定的变异类型标记，如SNP或INDEL，来确认它们是否存在。？怎么做？"></a>嗯，名字的时候我改了，验证gVCF内容：使用grep或其他工具查看原始gVCF文件中是否确实包含了SNPs和InDels。您可以查找特定的变异类型标记，如SNP或INDEL，来确认它们是否存在。？怎么做？</h2><p>要验证gVCF文件中是否确实包含了SNPs和InDels，您可以使用<code>grep</code>命令来搜索文件中的关键词，例如搜索<code>SNP</code>或<code>INDEL</code>标记。然而，在VCF或gVCF文件中，变异类型通常不会直接标记为“SNP”或“INDEL”。相反，您可以根据<code>REF</code>和<code>ALT</code>列的长度来区分它们：SNPs是<code>REF</code>和<code>ALT</code>长度都为1的情况，而InDels则是这两个字段长度不相等的情况。</p>
<p>下面是一些命令示例，它们可以帮助您查找gVCF文件中的SNPs和InDels：</p>
<h3 id="查找SNPs"><a href="#查找SNPs" class="headerlink" title="查找SNPs"></a>查找SNPs</h3><p>SNPs（单核苷酸多态性）的特征是参考(<code>REF</code>)和变异(<code>ALT</code>)等位基因长度都是1。您可以使用<code>grep</code>和<code>awk</code>结合使用来尝试找出这种模式的行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -v <span class="string">&quot;^#&quot;</span> /path/to/your/file.g.vcf | awk <span class="string">&#x27;length($4) == 1 &amp;&amp; length($5) == 1&#x27;</span></span><br></pre></td></tr></table></figure>

<p>这个命令做了以下几件事：</p>
<ul>
<li><code>grep -v &quot;^#&quot;</code>: 过滤掉所有以<code>#</code>开头的头部信息行，只留下包含变异数据的行。</li>
<li><code>awk &#39;length($4) == 1 &amp;&amp; length($5) == 1&#39;</code>: 使用<code>awk</code>检查每行的第4和第5字段（即<code>REF</code>和<code>ALT</code>列），找出长度都为1的行，这些通常代表SNPs。</li>
</ul>
<h3 id="查找InDels"><a href="#查找InDels" class="headerlink" title="查找InDels"></a>查找InDels</h3><p>InDels（插入或删除）的特征是<code>REF</code>和<code>ALT</code>字段长度不等。对于简单的筛选，您可以查找<code>REF</code>或<code>ALT</code>长度大于1的情况：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -v <span class="string">&quot;^#&quot;</span> /path/to/your/file.g.vcf | awk <span class="string">&#x27;length($4) != 1 || length($5) != 1&#x27;</span></span><br></pre></td></tr></table></figure>

<p>这个命令会筛选出那些至少在<code>REF</code>或<code>ALT</code>之一中长度不为1的行，这些通常代表InDels。</p>
<h3 id="注意-1"><a href="#注意-1" class="headerlink" title="注意"></a>注意</h3><p>这些命令提供了一种快速检查gVCF文件中是否含有SNPs和InDels的方法。然而，更复杂的变异类型（如多核苷酸多态性、复杂插入和删除等）需要更详细的分析来识别。此外，<code>awk</code>的条件可能需要根据实际情况进行调整，以适应特定的数据特点。</p>
<p>请确保替换<code>/path/to/your/file.g.vcf</code>为您实际的gVCF文件路径。这些命令在Unix-like系统的终端中运行，包括Linux和MacOS。</p>
<h3 id=""><a href="#" class="headerlink" title=""></a></h3><p>(base) dell@dell:/home/data1/renminpeng/SRR13786593$ grep -v “^#” sample11.g.vcf | awk ‘length($4) == 1 &amp;&amp; length($5) == 1’<br>(base) dell@dell:/home/data1/renminpeng/SRR13786593$ </p>
<p>您运行了一个命令来查找<code>sample11.g.vcf</code>文件中所有可能的SNPs（单核苷酸多态性），即那些<code>REF</code>（参考等位基因）和<code>ALT</code>（替代等位基因）长度都为1的变异。命令执行后，似乎没有输出任何内容，这意味着在您的gVCF文件中没有找到满足条件的行，或者说，没有检测到符合SNP标准（即<code>REF</code>和<code>ALT</code>长度均为1）的变异。</p>
<p>这种情况可能由以下几个原因导致：</p>
<ol>
<li><p><strong>样本中的真实SNPs数量较少</strong>：这可能是因为基因组较为同质，或者变异较少。</p>
</li>
<li><p><strong>测序或数据质量问题</strong>：如果测序数据质量不高，或者覆盖深度不足，可能导致变异检测不准确。</p>
</li>
<li><p><strong>参数设置问题</strong>：在进行变异检测时，如果参数设置过于严格，可能会错过一些真实的变异。</p>
</li>
<li><p><strong>数据处理步骤可能有问题</strong>：数据预处理过程（如比对、重复序列标记、重新排序等）中的任何问题都可能影响最终变异检测的结果。</p>
</li>
</ol>
<h3 id="解决建议"><a href="#解决建议" class="headerlink" title="解决建议"></a>解决建议</h3><ul>
<li><p><strong>检查数据质量</strong>：使用如<code>FastQC</code>之类的工具检查原始测序数据的质量，并确保数据预处理步骤正确无误。</p>
</li>
<li><p><strong>重新考虑变异检测参数</strong>：如果您在使用GATK等工具进行变异检测时使用了特别严格的参数，尝试调整这些参数以查看是否能够检测到更多变异。</p>
</li>
<li><p><strong>增加测序深度</strong>：对于深度不足的样本，考虑增加测序深度以提高变异检测的灵敏度。</p>
</li>
<li><p><strong>使用其他工具或方法</strong>：尝试使用不同的变异检测工具或算法，以及调整分析流程，看是否可以检测到SNPs。</p>
</li>
<li><p><strong>专家咨询</strong>：如果您仍然无法解决问题，可能需要咨询具有生物信息学背景的专家，或者在相关的论坛和社区中寻求帮助。</p>
</li>
</ul>
<p>请记住，没有检测到变异并不总是意味着分析失败或不存在变异，它可能是由于多种因素综合作用的结果。综合考虑数据质量、分析方法和生物学背景是理解这一结果的关键。</p>
<p>我下载的基因组文件在/home/data1/renminpeng/New1，命名为1.sra,2.sra等等，一直搭配68.sra<br>我的参考基因组文件在/home/data1/renminpeng/New里，命名为reference.fasta<br>我的软件也基本下载了</p>
<p>然后我想让你适当修改下下面的代码，让我能运行分析上面的数据？</p>
<p>#!/usr/local/bin/python3  </p>
<h1 id="coding-utf-8-2"><a href="#coding-utf-8-2" class="headerlink" title="-- coding: utf-8 --"></a>-<em>- coding: utf-8 -</em>-</h1><h1 id="This-script-file-shoud-be-at-the-same-directory-with-Cleandata-1"><a href="#This-script-file-shoud-be-at-the-same-directory-with-Cleandata-1" class="headerlink" title="This script file shoud be at the same directory with Cleandata"></a>This script file shoud be at the same directory with Cleandata</h1><h1 id="2022-02-09-1"><a href="#2022-02-09-1" class="headerlink" title="2022.02.09"></a>2022.02.09</h1><h1 id="delete-redundancy-bamFile-1"><a href="#delete-redundancy-bamFile-1" class="headerlink" title="delete redundancy  bamFile"></a>delete redundancy  bamFile</h1><h1 id="python3-0-t-9-i-input-dir-r-ReferenceFile-1"><a href="#python3-0-t-9-i-input-dir-r-ReferenceFile-1" class="headerlink" title="python3  $0 -t 9 -i input_dir -r ReferenceFile"></a>python3  $0 -t 9 -i input_dir -r ReferenceFile</h1><p>import os, sys, glob, time, argparse,threading</p>
<p>my_parser = argparse.ArgumentParser()</p>
<p>my_parser.add_argument(‘-t’, dest=’thread’,type=int,default=’4’) #线程数</p>
<p>my_parser.add_argument(‘-i’, dest=’input_dir’) #线程数</p>
<p>my_parser.add_argument(‘-r’, dest=’reference’) #线程数</p>
<p>args = my_parser.parse_args()</p>
<p>TimeTable = open(args.input_dir+’TimeTable.txt’,’w’)</p>
<p>ref=args.reference</p>
<p>output_bam_dir = args.input_dir + ‘_bam_dir’</p>
<p>output_gvcf_dir = args.input_dir + ‘_gvcf_dir’</p>
<p>if os.path.exists(output_bam_dir):</p>
<pre><code>sys.exit(output_bam_dir+&#39; exist!!!&#39;)
</code></pre>
<p>elif os.path.exists(output_gvcf_dir):</p>
<pre><code>sys.exit(output_gvcf_dir+&#39; exist!!!&#39;)
</code></pre>
<p>else:</p>
<pre><code>os.makedirs(output_bam_dir)

os.makedirs(output_gvcf_dir)
</code></pre>
<p>def mult(funct, ls, n=3):</p>
<pre><code>pool = []  # 线程池

length = len(ls)

step = int(length / n) + 1

for i in range(0, length, step):

    p = threading.Thread(target=funct, args=(ls[i: i + step],)) #把ls切成了n段，每段step长，最后段可能断一点

    pool.append(p)

for p in pool: #pool包含列表的列表，长度为n（即n个列表），每一个列表长度为step。

    p.start() #这里同时启动n个进程，一个进程里加入参数ls[i: i + step]，funct函数会对ls[i: i + step]慢慢处理。

for p in pool:

    p.join() #等待所有进程结束

print(time.strftime(&#39;%Y-%m-%d %H:%M:%S&#39;,time.localtime(time.time()))+&#39;_Main thread STAR exiting&#39;, file=TimeTable)

TimeTable.flush()
</code></pre>
<p>sample_names_dir = glob.glob(args.input_dir+’/*’) # Every sample has a directory which contain fq.gz file 每个样品单独一个文件夹，文件夹下包含fq.gz的文件 不包含绝对路径</p>
<p>bam_list = []</p>
<p>all_sample_fq = {} # This dictionary will include the sample’s name (key) and fq.gz (value) 字典以样品名为键，以1或2.fq.gz文件名为值</p>
<p>def bwa(part_sample_directory): #把bwa封装</p>
<pre><code>for sample_dir in part_sample_directory:

    sample_head = os.path.basename(sample_dir)

    if not (os.path.exists(sample_dir+&#39;/&#39;+sample_head+&#39;_R1.fq.gz&#39;) and os.path.exists(sample_dir+&#39;/&#39;+sample_head+&#39;_R1.fq.gz&#39;)):

        sys.exit(sample_dir+&#39;/&#39;+sample_head+&#39;_R1.fq.gz&#39; + &#39; or &#39;+sample_dir+&#39;/&#39;+sample_head+&#39;_R1.fq.gz&#39; + &quot; don&#39;t exist!!!&quot;)

    os.system(&#39;bwa mem -M -t 4 -R  &quot;@RG\\tID:&#123;0&#125;\\tSM:&#123;0&#125;\\tPL:illumina\\tLB:lib1\\tPU:unit1&quot; &#123;1&#125; &#123;2&#125;/&#123;0&#125;_R1.fq.gz &#123;2&#125;/&#123;0&#125;_R2.fq.gz | samtools view -bhS -o &#123;3&#125;/&#123;0&#125;.bam&#39;.format(sample_head, ref, sample_dir, output_bam_dir))

    print(time.strftime(&#39;%Y-%m-%d %H:%M:%S&#39;,time.localtime(time.time()))+&#39;bwa programming finished***In threading***&#39;+sample_head, file=TimeTable)

    TimeTable.flush()

    time.sleep(0.2)

    os.system(&#39;picard SortSam INPUT=&#123;0&#125;/&#123;1&#125;.bam OUTPUT=&#123;0&#125;/&#123;1&#125;_sorted.bam SORT_ORDER=coordinate TMP_DIR=./tmp&#39;.format(output_bam_dir,sample_head))

    time.sleep(0.2)

    os.system(&#39;rm &#123;0&#125;/&#123;1&#125;.bam&#39;.format(output_bam_dir,sample_head))

    os.system(&#39;picard AddOrReplaceReadGroups I=&#123;0&#125;/&#123;1&#125;_sorted.bam O=&#123;0&#125;/&#123;1&#125;_sorted_add.bam RGLB=lib1 RGPL=illumina RGPU=unit1 RGSM=&#123;1&#125; TMP_DIR=./tmp&#39;.format(output_bam_dir,sample_head))

    time.sleep(0.2)

    os.system(&#39;rm &#123;0&#125;/&#123;1&#125;_sorted.bam&#39;.format(output_bam_dir,sample_head))

    os.system(&#39;picard MarkDuplicates I=&#123;0&#125;/&#123;1&#125;_sorted_add.bam O=&#123;0&#125;/&#123;1&#125;_sorted_add_dedup.bam M=&#123;0&#125;/&#123;1&#125;_sorted_add_dedup.metrics CREATE_INDEX=true MAX_FILE_HANDLES_FOR_READ_ENDS_MAP=4000 TMP_DIR=./tmp&#39;.format(output_bam_dir,sample_head))

    time.sleep(0.2)

    os.system(&#39;rm &#123;0&#125;/&#123;1&#125;_sorted_add.bam&#39;.format(output_bam_dir,sample_head))

    print(time.strftime(&#39;%Y-%m-%d %H:%M:%S&#39;,time.localtime(time.time()))+&#39;picard BuildBamIndex programming finished***In threading***&#39;+sample_head, file=TimeTable)

    os.system(&quot;gatk3 -nct 4 -T HaplotypeCaller -R &#123;0&#125; --emitRefConfidence GVCF -I &#123;1&#125;/&#123;2&#125;_sorted_add_dedup.bam -o &#123;3&#125;/&#123;2&#125;.g.vcf&quot;.format(ref, output_bam_dir,sample_head,output_gvcf_dir))

    print(time.strftime(&#39;%Y-%m-%d %H:%M:%S&#39;,time.localtime(time.time()))+&#39;gatk3 programming finished***In threading***&#39;+sample_head, file=TimeTable)

    TimeTable.flush()

    bam_list.append(&#39;--variant  &#123;0&#125;/&#123;1&#125;.g.vcf&#39;.format(output_gvcf_dir,sample_head))
</code></pre>
<h2 id="-1"><a href="#-1" class="headerlink" title=""></a></h2><p>我下载的基因组文件在/home/data1/renminpeng/New1，命名为1.sra,2.sra等等，一直到68.sra，一共68个，上面的代码少了吧<br>我的参考基因组文件在/home/data1/renminpeng/New里，命名为reference.fasta</p>
<p>看看能不能帮我改改</p>
<p>为了确保代码能够处理从<code>1.sra</code>到<code>68.sra</code>的全部文件，并考虑到你的参考基因组文件的位置，我会对之前的代码示例进行相应的修改。下面的代码现在包括了处理特定范围内的文件名，从<code>1.sra</code>到<code>68.sra</code>，并假设这些文件都位于<code>/home/data1/renminpeng/New1</code>目录下。同时，参考基因组文件<code>reference.fasta</code>位于<code>/home/data1/renminpeng/New</code>目录中。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/local/bin/python3</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Genomic data analysis script adjusted for processing files 1.sra to 68.sra</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os, sys, glob, time, argparse, threading</span><br><span class="line"></span><br><span class="line"><span class="comment"># Setup command line arguments</span></span><br><span class="line">my_parser = argparse.ArgumentParser(description=<span class="string">&#x27;Genomic data analysis pipeline adjusted for specific .sra files&#x27;</span>)</span><br><span class="line">my_parser.add_argument(<span class="string">&#x27;-t&#x27;</span>, dest=<span class="string">&#x27;thread&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">int</span>, default=<span class="number">4</span>, <span class="built_in">help</span>=<span class="string">&#x27;Number of threads&#x27;</span>)</span><br><span class="line">my_parser.add_argument(<span class="string">&#x27;-i&#x27;</span>, dest=<span class="string">&#x27;input_dir&#x27;</span>, default=<span class="string">&#x27;/home/data1/renminpeng/New1&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;Input directory containing .sra files&#x27;</span>)</span><br><span class="line">my_parser.add_argument(<span class="string">&#x27;-r&#x27;</span>, dest=<span class="string">&#x27;reference&#x27;</span>, default=<span class="string">&#x27;/home/data1/renminpeng/New/reference.fasta&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;Reference genome file path&#x27;</span>)</span><br><span class="line">args = my_parser.parse_args()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create a time log file</span></span><br><span class="line">TimeTable = <span class="built_in">open</span>(os.path.join(args.input_dir, <span class="string">&#x27;TimeTable.txt&#x27;</span>), <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line"></span><br><span class="line">ref = args.reference</span><br><span class="line"></span><br><span class="line"><span class="comment"># Define output directories</span></span><br><span class="line">output_bam_dir = args.input_dir + <span class="string">&#x27;_bam_dir&#x27;</span></span><br><span class="line">output_gvcf_dir = args.input_dir + <span class="string">&#x27;_gvcf_dir&#x27;</span></span><br><span class="line">fastq_dir = args.input_dir + <span class="string">&#x27;_fastq&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Check and create output directories if not exist</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(output_bam_dir):</span><br><span class="line">    os.makedirs(output_bam_dir)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(output_gvcf_dir):</span><br><span class="line">    os.makedirs(output_gvcf_dir)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(fastq_dir):</span><br><span class="line">    os.makedirs(fastq_dir)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Function for parallel processing</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mult</span>(<span class="params">funct, ls, n=<span class="number">3</span></span>):</span><br><span class="line">    pool = []  <span class="comment"># Thread pool</span></span><br><span class="line">    length = <span class="built_in">len</span>(ls)</span><br><span class="line">    step = <span class="built_in">int</span>(length / n) + <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, length, step):</span><br><span class="line">        p = threading.Thread(target=funct, args=(ls[i: i + step],))</span><br><span class="line">        pool.append(p)</span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> pool:</span><br><span class="line">        p.start()</span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> pool:</span><br><span class="line">        p.join()</span><br><span class="line">    <span class="built_in">print</span>(time.strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>, time.localtime(time.time())) + <span class="string">&#x27;_Main thread STAR exiting&#x27;</span>, file=TimeTable)</span><br><span class="line">    TimeTable.flush()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Convert .sra to .fq and perform alignment</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sra_to_fq_and_bwa</span>(<span class="params">sra_files</span>):</span><br><span class="line">    <span class="keyword">for</span> sra_file <span class="keyword">in</span> sra_files:</span><br><span class="line">        sample_head = os.path.basename(sra_file).split(<span class="string">&#x27;.&#x27;</span>)[<span class="number">0</span>]  <span class="comment"># Assuming filename &quot;1.sra&quot;, sample_head would be &quot;1&quot;</span></span><br><span class="line">        <span class="comment"># Convert .sra to .fq.gz using fastq-dump</span></span><br><span class="line">        fq1_path = os.path.join(fastq_dir, <span class="string">f&quot;<span class="subst">&#123;sample_head&#125;</span>_1.fastq.gz&quot;</span>)</span><br><span class="line">        fq2_path = os.path.join(fastq_dir, <span class="string">f&quot;<span class="subst">&#123;sample_head&#125;</span>_2.fastq.gz&quot;</span>)</span><br><span class="line">        os.system(<span class="string">f&#x27;fastq-dump --split-files --gzip --outdir <span class="subst">&#123;fastq_dir&#125;</span> <span class="subst">&#123;sra_file&#125;</span>&#x27;</span>)</span><br><span class="line">        <span class="comment"># Check if FASTQ files were created</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(fq1_path) <span class="keyword">or</span> <span class="keyword">not</span> os.path.exists(fq2_path):</span><br><span class="line">            sys.exit(<span class="string">f&quot;Error converting <span class="subst">&#123;sra_file&#125;</span> to FASTQ format.&quot;</span>)</span><br><span class="line">        <span class="comment"># Execute BWA alignment, followed by processing steps</span></span><br><span class="line">        bam_output = os.path.join(output_bam_dir, <span class="string">f&quot;<span class="subst">&#123;sample_head&#125;</span>.bam&quot;</span>)</span><br><span class="line">        <span class="comment"># Ensure commands such as BWA, samtools are available in your environment</span></span><br><span class="line">        os.system(<span class="string">f&#x27;bwa mem -M -t <span class="subst">&#123;args.thread&#125;</span> -R &quot;@RG\\tID:<span class="subst">&#123;sample_head&#125;</span>\\tSM:<span class="subst">&#123;sample_head&#125;</span>\\tPL:illumina\\tLB:lib1\\tPU:unit1&quot; <span class="subst">&#123;ref&#125;</span> <span class="subst">&#123;fq1_path&#125;</span> <span class="subst">&#123;fq2_path&#125;</span> | samtools view -bhS - &gt; <span class="subst">&#123;bam_output&#125;</span>&#x27;</span>)</span><br><span class="line">        <span class="comment"># Further processing steps can be adjusted here</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Prepare a list of .sra files to process</span></span><br><span class="line">sra_files_to_process = [os.path.join(args.input_dir, <span class="string">f&quot;<span class="subst">&#123;i&#125;</span>.sra&quot;</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">69</span>)]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Process .sra files</span></span><br><span class="line">mult(sra_to_fq_and_bwa, sra_files_to_process, n=args.thread)</span><br></pre></td></tr></table></figure>

<p>这个脚本首先会生成一个处理范</p>
<p>围内所有<code>.sra</code>文件（即从<code>1.sra</code>到<code>68.sra</code>）的文件列表，然后使用多线程调用<code>fastq-dump</code>进行格式转换，并对转换后的<code>.fq</code>文件进行比对处理。</p>
<p>请确保你有足够的权限访问这些目录和文件，并且已经安装了所有必要的软件，如SRA Toolkit、BWA、Samtools等。此外，根据实际环境和需求，你可能需要对命令行参数和工具的调用方式进行进一步调整。</p>
<p>为了运行上述脚本，你需要确保安装并能正确调用以下软件：</p>
<ol>
<li><strong>SRA Toolkit</strong> - 用于<code>.sra</code>到<code>.fq</code>格式的转换。</li>
<li><strong>BWA</strong> - 用于序列比对。</li>
<li><strong>Samtools</strong> - 用于处理SAM/BAM文件格式。</li>
<li><strong>Picard</strong> - 用于BAM文件处理，如排序、去重等。</li>
<li><strong>GATK</strong> (可选，如果你计划运行GATK相关命令) - 用于变异检测等复杂分析。</li>
</ol>
<p>要验证这些软件是否能在你的环境中正确调用，你可以使用命令行执行以下命令：</p>
<h3 id="SRA-Toolkit-fastq-dump"><a href="#SRA-Toolkit-fastq-dump" class="headerlink" title="SRA Toolkit (fastq-dump)"></a>SRA Toolkit (<code>fastq-dump</code>)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastq-dump --version</span><br></pre></td></tr></table></figure>

<p>这条命令会输出<code>fastq-dump</code>的版本号，如果软件已正确安装。</p>
<h3 id="BWA"><a href="#BWA" class="headerlink" title="BWA"></a>BWA</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bwa</span><br></pre></td></tr></table></figure>

<p>这条命令会显示BWA的帮助信息和使用说明，表示BWA已正确安装。</p>
<h3 id="Samtools"><a href="#Samtools" class="headerlink" title="Samtools"></a>Samtools</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">samtools --version</span><br></pre></td></tr></table></figure>

<p>这条命令会输出<code>samtools</code>的版本号，如果软件已正确安装。</p>
<h3 id="Picard"><a href="#Picard" class="headerlink" title="Picard"></a>Picard</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar picard.jar</span><br></pre></td></tr></table></figure>

<p>注意：对于Picard，你需要确保Java已安装，并且<code>picard.jar</code>的路径正确。这条命令会显示Picard的帮助信息。如果你没有看到帮助信息，请确保你提供了正确的<code>picard.jar</code>路径。</p>
<h3 id="GATK"><a href="#GATK" class="headerlink" title="GATK"></a>GATK</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gatk --version</span><br></pre></td></tr></table></figure>

<p>或者，如果你使用的是GATK3，</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar GenomeAnalysisTK.jar --version</span><br></pre></td></tr></table></figure>

<p>同样，对于GATK3，确保提供了正确的<code>GenomeAnalysisTK.jar</code>文件路径。</p>
<p><strong>注意</strong>：对于Java应用（Picard和GATK），你需要Java运行环境（JRE）或Java开发工具包（JDK）。使用<code>java -version</code>命令可以检查Java是否安装。</p>
<p>如果上述命令中的任何一个没有按预期工作，可能意味着相应的软件没有被正确安装或者没有被添加到系统的PATH环境变量中。确保按照每个软件的安装指南进行安装，并且如果需要，将其可执行文件的路径添加到你的系统PATH中。</p>
<p>time.sleep(0.2)</p>
<pre><code>    os.system(&#39;picard SortSam INPUT=&#123;0&#125;/&#123;1&#125;.bam OUTPUT=&#123;0&#125;/&#123;1&#125;_sorted.bam SORT_ORDER=coordinate TMP_DIR=./tmp&#39;.format(output_bam_dir,sample_head))

    time.sleep(0.2)

    os.system(&#39;rm &#123;0&#125;/&#123;1&#125;.bam&#39;.format(output_bam_dir,sample_head))

    os.system(&#39;picard AddOrReplaceReadGroups I=&#123;0&#125;/&#123;1&#125;_sorted.bam O=&#123;0&#125;/&#123;1&#125;_sorted_add.bam RGLB=lib1 RGPL=illumina RGPU=unit1 RGSM=&#123;1&#125; TMP_DIR=./tmp&#39;.format(output_bam_dir,sample_head))

    time.sleep(0.2)

    os.system(&#39;rm &#123;0&#125;/&#123;1&#125;_sorted.bam&#39;.format(output_bam_dir,sample_head))

    os.system(&#39;picard MarkDuplicates I=&#123;0&#125;/&#123;1&#125;_sorted_add.bam O=&#123;0&#125;/&#123;1&#125;_sorted_add_dedup.bam M=&#123;0&#125;/&#123;1&#125;_sorted_add_dedup.metrics CREATE_INDEX=true MAX_FILE_HANDLES_FOR_READ_ENDS_MAP=4000 TMP_DIR=./tmp&#39;.format(output_bam_dir,sample_head))

    time.sleep(0.2)

    os.system(&#39;rm &#123;0&#125;/&#123;1&#125;_sorted_add.bam&#39;.format(output_bam_dir,sample_head))

    print(time.strftime(&#39;%Y-%m-%d %H:%M:%S&#39;,time.localtime(time.time()))+&#39;picard BuildBamIndex programming finished***In threading***&#39;+sample_head, file=TimeTable)

    os.system(&quot;gatk3 -nct 4 -T HaplotypeCaller -R &#123;0&#125; --emitRefConfidence GVCF -I &#123;1&#125;/&#123;2&#125;_sorted_add_dedup.bam -o &#123;3&#125;/&#123;2&#125;.g.vcf&quot;.format(ref, output_bam_dir,sample_head,output_gvcf_dir))

    print(time.strftime(&#39;%Y-%m-%d %H:%M:%S&#39;,time.localtime(time.time()))+&#39;gatk3 programming finished***In threading***&#39;+sample_head, file=TimeTable)

    TimeTable.flush()

    bam_list.append(&#39;--variant  &#123;0&#125;/&#123;1&#125;.g.vcf&#39;.format(output_gvcf_dir,sample_head))
</code></pre>
<p>就这些代码，再给我设计一个脚本，运行这代码？你能参考这个，让我进行后续分析吗？开始的代码生成了1.bam到68.bam,在/home/data1/renminpeng/New1_bam_dir路径下，<br>我的参考基因组文件在/home/data1/renminpeng/New里，命名为reference.fasta，也已经索引了，软件基本也能用</p>
<p>#!/usr/local/bin/python3</p>
<h1 id="coding-utf-8-3"><a href="#coding-utf-8-3" class="headerlink" title="-- coding: utf-8 --"></a>-<em>- coding: utf-8 -</em>-</h1><p>“””<br>Script for processing BAM files and performing variant calling<br>to generate gVCF files.<br>“””</p>
<p>import os<br>import subprocess<br>import argparse</p>
<p>def parse_arguments():<br>    parser = argparse.ArgumentParser(description=’Perform variant calling on pre-processed BAM files.’)<br>    parser.add_argument(‘-b’, ‘–bam_dir’, required=True, help=’Directory containing pre-processed BAM files (sorted and deduped)’)<br>    parser.add_argument(‘-r’, ‘–reference’, required=True, help=’Path to the reference genome fasta file’)<br>    parser.add_argument(‘-o’, ‘–output_dir’, required=True, help=’Output directory for gVCF files’)<br>    return parser.parse_args()</p>
<p>def call_variants(bam_dir, reference, output_dir):<br>    if not os.path.exists(output_dir):<br>        os.makedirs(output_dir)</p>
<pre><code>bam_files = [f for f in os.listdir(bam_dir) if f.endswith(&#39;_sorted_add_dedup.bam&#39;)]

for bam_file in bam_files:
    sample_name = os.path.splitext(bam_file)[0]
    dedup_bam = os.path.join(bam_dir, bam_file)
    gvcf_file = os.path.join(output_dir, f&quot;&#123;sample_name&#125;.g.vcf&quot;)
    
    # Variant Calling with the specified GATK path
    subprocess.run(f&#39;java -jar /home/data1/renminpeng/SRR2131201/gatk-package-4.1.8.1-local.jar HaplotypeCaller -R &#123;reference&#125; -I &#123;dedup_bam&#125; -O &#123;gvcf_file&#125; -ERC GVCF&#39;, shell=True)
    
    print(f&#39;Finished processing &#123;bam_file&#125;&#39;)
</code></pre>
<p>def main():<br>    args = parse_arguments()<br>    call_variants(args.bam_dir, args.reference, args.output_dir)</p>
<p>if <strong>name</strong> == “<strong>main</strong>“:<br>    main()</p>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">花粱</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://wplfge3.github.io/2024/03/02/%E5%85%A8%E5%9F%BA%E5%9B%A0%E7%BB%84%E9%87%8D%E6%B5%8B%E5%BA%8F/">https://wplfge3.github.io/2024/03/02/%E5%85%A8%E5%9F%BA%E5%9B%A0%E7%BB%84%E9%87%8D%E6%B5%8B%E5%BA%8F/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">花粱</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            <span class="chip bg-color">无标签</span>
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2024/03/02/%E4%BA%BA%E9%99%85%E5%9C%88/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/5.jpg" class="responsive-img" alt="人际圈">
                        
                        <span class="card-title">人际圈</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            Here's something encrypted, password is required to continue reading.
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2024-03-02
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            花粱
                            
                        </span>
                    </div>
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2024/02/29/%E9%87%8D%E8%A3%85%E4%BA%86%E7%B3%BB%E7%BB%9F/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/18.jpg" class="responsive-img" alt="重装了系统">
                        
                        <span class="card-title">重装了系统</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2024-02-29
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            花粱
                            
                        </span>
                    </div>
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>



<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>



    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="tencent"
                   type="playlist"
                   id="8835905093"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="/libs/aplayer/Meting.min.js"></script>

    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2023-2024</span>
            
            <a href="/about" target="_blank">花粱</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            
            <br>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/blinkfox" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:1181062873@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1181062873" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1181062873" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 白天和黑夜主题 -->
<div class="stars-con">
    <div id="stars"></div>
    <div id="stars2"></div>
    <div id="stars3"></div>  
</div>

<script>
    function switchNightMode() {
        $('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($('body')),
        setTimeout(function () {
            $('body').hasClass('DarkMode') 
            ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#sum-moon-icon').removeClass("fa-sun").addClass('fa-moon')) 
            : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#sum-moon-icon').addClass("fa-sun").removeClass('fa-moon')),
            
            setTimeout(function () {
            $('.Cuteen_DarkSky').fadeOut(1e3, function () {
                $(this).remove()
            })
            }, 2e3)
        })
    }
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    

    
    
    
        
        <script type="text/javascript">
            // 只在桌面版网页启用特效
            var windowWidth = $(window).width();
            if (windowWidth > 768) {
                document.write('<script type="text/javascript" src="/libs/others/sakura.js"><\/script>');
            }
        </script>
    

    <!-- 雪花特效 -->
    

    <!-- 鼠标星星特效 -->
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="/libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
